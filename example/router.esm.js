function M(j,{templateTargetId:z="",templates:J=[],handlers:K=[],preload:Z=!1}={}){return{pattern:j.indexOf(":")!==-1?a(j):void 0,programmaticTemplates:!!J.length,templateTargetId:z,templates:J,handlers:K,preload:Z,path:j,match(G){if(this.pattern){let B=G.match(this.pattern);if(!B)return{match:!1};return{match:!0,params:B.groups}}return{match:G===this.path}}}}var a=(j)=>{j=j.endsWith("/")?j.slice(0,-1):j;let z,J=j.split("/").map((K,Z)=>{if(Z==0)return K;if(!K.startsWith(":"))return"/"+K;let q=K.substring(1),G="[^/]+";if(q.endsWith("?"))q=q.slice(0,-1),z=!0;else if(q.endsWith("*"))q=q.slice(0,-1),G=".*";else if(q.includes("(")){let B=q.match(/\((.+?)\)/);if(B)q=q.substring(0,q.indexOf("(")),G=B[1]}if(z)return`(?:/(?<${q}>${G}))?`;else return`/(?<${q}>${G})`}).join("");return new RegExp(`^${J}/?$`)};async function I(j,z,J){j.handlersDone=!1,j.cancelHandlers=!1;for(let K of z){if(j.cancelHandlers)return j.cancelHandlers=!1,0;if((K.constructor.name==="AsyncFunction"?await K(J):K(J))===0)return 0}if(!j.cancelHandlers)return j.handlersDone=!0,1;return 0}var L=(j,{route:z,params:J,navigationIndex:K,navigationStack:Z})=>({path:j,route:z,params:J,navigationIndex:K,navigationStack:Z,query:window.location.search.substring(1),hash:window.location.hash.substring(1)});var C={},k={},v=new Set,l=(j,z)=>{document.dispatchEvent(new CustomEvent("pinecone:fetch-error",{detail:{error:j,url:z}}))},g=(j,z,J,K,Z)=>{let q=z.id+J;if(v.has(q))return;v.add(q);let G=z.content,B=Array(G.childElementCount);G.querySelectorAll("script").forEach(($)=>{let W=document.createElement("script");Array.from($.attributes).forEach((X)=>W.setAttribute(X.name,X.value)),W.textContent=$.textContent,$.parentNode?.replaceChild(W,$)}),Array.from(G.children).forEach(($,W)=>{let X=$.cloneNode(!0);B[W]=X,j.addScopeToNode(X,{},z)}),j.mutateDom(()=>{if(K!=null)K.replaceChildren(...B);else z.after(...B);B.forEach(($)=>{j.initTree($)})}),z._x_PineconeRouter_template=B,z._x_PineconeRouter_templateUrls=Z,z._x_PineconeRouter_undoTemplate=()=>{j.mutateDom(()=>{B.forEach(($)=>{j.destroyTree($),$.remove()})}),delete z._x_PineconeRouter_template},j.nextTick(()=>v.delete(q))},w=(j)=>{if(j._x_PineconeRouter_undoTemplate)j._x_PineconeRouter_undoTemplate(),delete j._x_PineconeRouter_undoTemplate},y=(j,z,J,K,Z,q)=>{if(J._x_PineconeRouter_templateUrls!=null&&J._x_PineconeRouter_templateUrls!=Z)w(J),J.innerHTML="";if(J._x_PineconeRouter_template){z.endLoading();return}if(J.content.childElementCount)g(j,J,K,q,Z),z.endLoading();else if(Z)O(Z,J).then(()=>g(j,J,K,q,Z)).finally(()=>z.endLoading())},P=(j,z)=>{return j.map((J)=>{return J.replace(/:([^/.]+)/g,(K,Z)=>{return z[Z]||Z})})},T=async(j)=>{if(C.hasOwnProperty(j))return C[j];else if(k[j])return k[j];else return C[j]=fetch(j).then((z)=>{if(!z.ok){l(z.statusText,j);return}return z.text()}).then((z)=>{if(!z)return"";return k[j]=z,delete C[j],z}),C[j]},A=(j)=>{j.forEach(T)},O=(j,z)=>{return Promise.all(j.map(T)).then((J)=>{return z.innerHTML=J.join(""),z.innerHTML})};var f=(j)=>`Invalid template type: ${j}. Expected an array of strings.`,E=(j)=>`Can't find an element with the supplied target ID: ${j}`,x=(j)=>`Route already exists: ${j}`;var V="Directives can only be used on template elements.",b=(j)=>`x-${j} must be used on the same element as x-route.`,c="x-template cannot be used alongside an inline template (template element should not have a child).",R="templateTargetId must be specified for programmatically added templates.",m=(j)=>`Invalid handler type: ${j}.`,h=(j)=>`Path: ${j} was not found.`;class F extends Error{constructor(j){super(j);this.name="PineconeRouterError",Object.setPrototypeOf(this,F.prototype)}}var H=(j,z)=>z.findIndex((J)=>J.path==j),U=(j,z,J)=>{if(j.indexOf(z)===-1)return J;let K=j[j.indexOf(z)+1];if(!K)return J;if(z==="target"){let Z=K.match(/([a-z0-9_-]+)/);if(Z)return Z[1]}return K},D=(j,z)=>{if(z!="/"&&!j.startsWith(z))j=z+j;if(j==z&&!j.endsWith("/"))j+="/";return j},N=(j,z)=>{let J=j??z??"",K=document.getElementById(J)??void 0;if(J.length&&K==null)throw new F(E(J));return K};var d=(j)=>{let z=M("notfound",{handlers:[(Z)=>console.error(new F(h(Z.path)))]}),J=L("",{route:z,params:{},navigationStack:[],navigationIndex:0});return{version:j,name:"pinecone-router",notfound:z,routes:[],globalHandlers:[],cancelHandlers:!1,handlersDone:!1,context:J,settings:{hash:!1,basePath:"/",templateTargetId:void 0,interceptLinks:!0,alwaysSendLoadingEvents:!1},loadStart:new Event("pinecone:start"),loadEnd:new Event("pinecone:end"),loading:!1,startLoading:function(){if(!this.loading)document.dispatchEvent(this.loadStart),this.loading=!0},endLoading:function(){if(this.loading)document.dispatchEvent(this.loadEnd),this.loading=!1},add:function(Z,q){if(this.routes.find((G)=>G.path==Z)!=null)throw new F(x(Z));if(q.templates&&q.preload)A(q.templates);return this.routes.push(M(Z,q))-1},remove:function(Z){let q=this.routes.findIndex((G)=>G.path==Z);delete this.routes[q]},redirect:function(Z){return this.navigate(Z),0},canGoBack:function(){return this.context.navigationIndex>0},back:function(){this.navigate(this.context.navigationStack[this.context.navigationIndex-1],!1,!1,this.context.navigationIndex-1)},canGoForward:function(){return this.context.navigationIndex<this.context.navigationStack.length-1},forward:function(){this.navigate(this.context.navigationStack[this.context.navigationIndex+1],!1,!1,this.context.navigationIndex+1)},navigate:async function(Z,q=!1,G=!1,B){if(!this.handlersDone)this.cancelHandlers=!0;if(!Z)Z="/";Z=D(Z,this.settings.basePath);let $=L(Z,{...this.context}),W=this.routes.find((Y)=>{let Q=Y.match(Z);if(Q.params)$.params=Q.params;return Q.match})??this.notfound;if($.route=W,this.settings.alwaysSendLoadingEvents||(W.handlers.length||this.globalHandlers.length||W.templates.length)&&this.context.path!=Z)this.startLoading();if(!q){let Y=this.settings.hash?"#"+Z:Z+window.location.hash;if(!G)history.pushState({path:Y},"",Y);else if(this.settings.hash&&Z==="/")return this.navigate("/",!1,!1)}if(W.handlers.length||this.globalHandlers.length){if(await I(this,this.globalHandlers.concat(W.handlers),$)==0){this.endLoading();return}if(!W.templates)this.endLoading()}else this.handlersDone=!0;if(B!=null)$.navigationIndex=B;else if(Z!=this.context.path){if($.navigationIndex<$.navigationStack.length-1)$.navigationStack=$.navigationStack.slice(0,$.navigationIndex+1);$.navigationStack.push(Z),$.navigationIndex=$.navigationStack.length-1}this.context=$;let X=(Y)=>document.dispatchEvent(new CustomEvent(`pinecone:${Y}`,{detail:{context:$}}));if(X("navigate"),this.context.route.path===W.path)if(this.context.path!=$.path)X("update");else X("refresh");else X("change");if(W.programmaticTemplates){let Y=document.getElementById(W.templateTargetId??this.settings.templateTargetId);if(!Y)throw new F(R);O(W.templates,Y).finally(()=>this.endLoading())}if(this.settings.alwaysSendLoadingEvents)this.endLoading()}}};var u=(j,z)=>{j.directive("template",(J,{expression:K,modifiers:Z},{evaluate:q,cleanup:G,Alpine:B,effect:$})=>{if(!(J instanceof HTMLTemplateElement))throw new F(V);let W=J;if(W.content.firstElementChild!=null)throw new F(c);if(K=K.trim(),!(K.startsWith("[")&&K.endsWith("]"))&&!(K.startsWith("Array")&&K.endsWith(")")))K=`['${K}']`;let X=q(K),Y;if(typeof X=="object"&&Array.isArray(X))Y=X;else throw new F(f(typeof X));let Q=N(U(Z,"target"),z.settings.templateTargetId);if(Z.includes("preload"))O(Y,W);if(W._x_PineconeRouter_route==null)throw new F(b("template"));let _=W._x_PineconeRouter_route,S=_=="notfound"?z.notfound:z.routes[H(_,z.routes)];S.templates=Y;let p=()=>{if(z.handlersDone&&z.context.route==S){if(Z.includes("interpolate"))Y=P(S.templates,z.context.params);y(B,z,W,K,Y,Q)}else w(W)};B.nextTick(()=>$(p)),G(()=>{W._x_PineconeRouter_undoTemplate&&W._x_PineconeRouter_undoTemplate()})})};var s=(j,z)=>{j.directive("handler",(J,{expression:K,modifiers:Z},{evaluate:q,cleanup:G})=>{if(K=K.trim(),!(K.startsWith("[")&&K.endsWith("]"))&&!(K.startsWith("Array")&&K.endsWith(")")))K=`[${K}]`;let B=q(K);if(typeof B!="object")throw new F(m(typeof B));let $=B;for(let X=0;X<$.length;X++)$[X]=$[X].bind(j.$data(J));let W;if(Z.includes("global"))z.globalHandlers=$;else{if(!J._x_PineconeRouter_route)throw new F(b("handler"));let X=J._x_PineconeRouter_route;W=X=="notfound"?z.notfound:z.routes[H(X,z.routes)],W.handlers=$}G(()=>{if(Z.includes("global"))z.globalHandlers=[];else W.handlers=[]})}).before("template")};var i=(j,z)=>{j.directive("route",(J,{expression:K,modifiers:Z},{cleanup:q,effect:G})=>{let B=K;if(!(J instanceof HTMLTemplateElement))throw new F(V);let $=J,W=N(U(Z,"target"),z.settings.templateTargetId),X;if(B!="notfound")B=D(B,z.settings.basePath),X=z.add(B,{});let Y=X!=null?z.routes[X]:z.notfound;if($._x_PineconeRouter_route=B,$.content.childElementCount)j.nextTick(()=>{G(()=>{z.handlersDone&&z.context.route==Y?y(j,z,$,K,void 0,W):w($)})});q(()=>{if($._x_PineconeRouter_undoTemplate&&$._x_PineconeRouter_undoTemplate(),X!=null)delete z.routes[X];delete $._x_PineconeRouter_route})}).before("handler")};var n=(j)=>{function z(J){if(!J||!J.getAttribute)return;let K=J.getAttribute("href"),Z=J.getAttribute("target");if(!K||!K.match(/^\//g)||Z&&!Z.match(/^_?self$/i))return;return K}window.document.body.addEventListener("click",function(J){if(J.ctrlKey||J.metaKey||J.altKey||J.shiftKey||J.button||J.defaultPrevented)return;let K=J.target;do if(K instanceof HTMLAnchorElement&&K.getAttribute("href")){if(j.settings.interceptLinks==!1&&!K.hasAttribute("x-link"))return;if(K.hasAttribute("data-native")||K.hasAttribute("native"))return;let Z=z(K);if(Z){if(j.navigate(Z),J.stopImmediatePropagation)J.stopImmediatePropagation();if(J.stopPropagation)J.stopPropagation();J.preventDefault()}break}while(K=K.parentNode)})};var o=function(j){let z=j.reactive(d("7.0.0"));window.PineconeRouter=z,document.addEventListener("alpine:initialized",()=>{if(z.settings.hash==!1)z.navigate(location.pathname+location.search,!1,!0);else z.navigate(location.hash.substring(1),!1,!0)}),window.addEventListener("popstate",()=>{if(z.settings.hash){if(window.location.hash!="")z.navigate(window.location.hash.substring(1),!0)}else z.navigate(window.location.pathname,!0)}),u(j,z),s(j,z),i(j,z),j.$router=z,j.$params=z.context.params,j.magic("router",()=>z),j.magic("params",()=>z.context.params),n(z)},g1=o;export{g1 as default};

//# debugId=E199F7A27E883E9764756E2164756E21
//# sourceMappingURL=router.esm.js.map
