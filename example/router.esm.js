var Kj=(j)=>`Invalid expression type. Expression: ${j}`,v=(j)=>`Can't find an element with target ID: ${j}`,x=(j)=>`Route already exists: ${j}`;var Zj=(j)=>`x-${j} must be used on the same template as x-route`,g="targetID must be specified for programmatically added templates",c=(j)=>`Path: ${j} was not found`;function S(j){if(j.tagName.toLowerCase()!=="template")throw new TypeError("Directives can only be used on template elements.")}function y(j){if(S(j),j._x_PineconeRouter_route===void 0)throw new TypeError(Zj("template"))}function N(j){if(typeof j!="object"||!Array.isArray(j))throw new TypeError(Kj(j))}var m=(j,J,b)=>{if(j.indexOf(J)===-1)return b;let z=j[j.indexOf(J)+1];if(!z)return b;if(J==="target"){let Z=z.match(/([a-z0-9_-]+)/);if(Z)return Z[1]}return z},B=(j,J)=>{if(j=="notfound")return j;if(!j.startsWith(J))j=J+j;return j},O=(j)=>{return/^\[.*\]$|^Array\(.*\)$/.test(j.trim())},d=(j,J)=>{let b=j??J??"",z=document.getElementById(b);if(b&&!z)throw new ReferenceError(v(b));return z??void 0};var $={hash:!1,basePath:"",globalHandlers:[],handleClicks:!0,targetID:void 0,preload:!1},u=(j)=>{return $={...$,...j},$};var _=new Set,T=new Map,w=new Map,P=new Set,h=(j,J)=>{document.dispatchEvent(new CustomEvent("pinecone:fetch-error",{detail:{error:j,url:J}}))},p=(j,J,b,z,Z)=>{let H=J.id+b;if(_.has(H))return;_.add(H);let Q=J.content,Y=Array(Q.childElementCount);Q.querySelectorAll("script").forEach((K)=>{let G=document.createElement("script");Array.from(K.attributes).forEach((F)=>G.setAttribute(F.name,F.value)),G.textContent=K.textContent,K.parentNode?.replaceChild(G,K)});let W=Array.from(Q.children);for(let K=0;K<W.length;K++)Y[K]=W[K].cloneNode(!0),j.addScopeToNode(Y[K],{},J);j.mutateDom(()=>{if(z)z.replaceChildren(...Y);else J.after(...Y);Y.forEach((K)=>{j.initTree(K)})}),J._x_PineconeRouter_template=Y,J._x_PineconeRouter_templateUrls=Z,J._x_PineconeRouter_undoTemplate=()=>{j.mutateDom(()=>{Y.forEach((K)=>{j.destroyTree(K),K.remove()})}),delete J._x_PineconeRouter_template,delete J._x_PineconeRouter_templateUrls},j.nextTick(()=>_.delete(H))},E=(j)=>{if(j._x_PineconeRouter_undoTemplate)j._x_PineconeRouter_undoTemplate(),delete j._x_PineconeRouter_undoTemplate},n=async(j,J,b,z,Z)=>{if(J._x_PineconeRouter_templateUrls!=null&&J._x_PineconeRouter_templateUrls!=z)E(J),J.innerHTML="";if(J._x_PineconeRouter_template)return;if(J.content.childElementCount){p(j,J,b,Z,z);return}if(z)return I(z,J).then(()=>p(j,J,b,Z,z))},D=(j,J)=>{return j.map((b)=>b.replace(/:([^/.]+)/g,(z,Z)=>J[Z]||Z))},i=async(j,J="high")=>{if(j=B(j,$.basePath),T.has(j))return T.get(j);if(w.has(j))return w.get(j);let b=fetch(j,{priority:J}).then((z)=>{if(!z.ok)return h(z.statusText,j),"";return z.text()}).then((z)=>{if(z)T.set(j,z);return w.delete(j),z||""}).catch((z)=>{if(z instanceof TypeError)h(z.message,j);return""});return w.set(j,b),b},k=(j,J)=>{P.add({urls:j,el:J})},o=()=>{for(let j of P){if(j.el)I(j.urls,j.el,"low");else j.urls.map((J)=>i(J,"low"));P.delete(j)}},I=(j,J,b="high")=>Promise.all(j.map((z)=>i(z,b))).then((z)=>{J.innerHTML=z.join("")});var $j=(j,J)=>{j.directive("template",(b,{expression:z,modifiers:Z},{evaluate:H,cleanup:Q,Alpine:Y,effect:W})=>{y(b);let K=d(m(Z,"target"),$.targetID),G=b._x_PineconeRouter_route,F,q=Z.includes("interpolate");if(z!=""){if(!O(z))z=`['${z}']`;let M=H(z);if(N(M),F=M,!q&&($.preload||Z.includes("preload")))k(F,b);let L=J.routes.get(G);L.templates=F}let X=(M)=>{if(J.context.route?.path===G){if(M&&q)M=D(M,J.context.params);n(Y,b,z,M,K).then(()=>{J.loading=!1})}else E(b)},C=W(()=>X(F));Q(()=>{b._x_PineconeRouter_undoTemplate&&b._x_PineconeRouter_undoTemplate(),Y.release(C)})})},s=$j;var Qj=(j,J)=>{j.directive("handler",(b,{expression:z,modifiers:Z},{evaluate:H,cleanup:Q})=>{if(!O(z))z=`[${z}]`;let Y=H(z);N(Y);let W=Y;for(let G=0;G<W.length;G++)W[G]=W[G].bind(j.$data(b));let K;if(Z.includes("global"))$.globalHandlers=W;else{y(b);let G=b._x_PineconeRouter_route;K=J.routes.get(G),K.handlers=W}Q(()=>{if(Z.includes("global"))$.globalHandlers=[];else K.handlers=[]})}).before("template")},l=Qj;var Yj=(j,J)=>{j.directive("route",(b,{expression:z,value:Z},{cleanup:H})=>{let Q=B(z,$.basePath);if(S(b),Q!="notfound")J.add(Q,{name:Z});b._x_PineconeRouter_route=Q,H(()=>{J.routes.delete(Q),delete b._x_PineconeRouter_route})}).before("handler")},a=Yj;var r=()=>{return{entries:[],index:0,canGoBack:function(){return this.index>0},back:function(){this.to(this.index-1)},canGoForward:function(){return this.index<this.entries.length-1},forward:function(){this.to(this.index+1)},to:function(j){if(j in this.entries)this.router?.navigate(this.entries[j],!1,!1,j)},push:function(j,J,b){if(this.index<this.entries.length-1)this.entries=this.entries.slice(0,this.index+1);if(this.entries.push(j),this.index=this.entries.length-1,J)this.pushState(j,b)},pushState:function(j,J){let b=J&&!j.startsWith("#")?"#"+j:j;history.pushState({path:b},"",b)},setRouter(j){this.router=j}}};var Gj=(j,{targetID:J,templates:b=[],handlers:z=[],interpolate:Z=!1,name:H}={})=>({programmaticTemplates:b.length>0,pattern:Hj(j),interpolate:Z,templates:b,targetID:J,handlers:z,name:H||j,path:j,match(Q){let Y=this.pattern.exec(Q);if(Y)return{...Y.groups}}});function Hj(j){let b=j.split("/").filter(Boolean).map((z)=>{if(!z.startsWith(":"))return"/"+z;let[,Z,H,Q]=z.match(/^:(\w+)([?+*]?)(?:\.(.+))?$/)||[],Y=H==="*"||H==="+",W=H==="?"||H==="*",G=`(?<${Z}>${Y?W?".*?":".+":"[^/]+?"})`,F=Q?`\\.${Q}`:"",q=G+F;if(W)return`(?:/${q})?`;return`/${q}`}).join("");return new RegExp(`^${b}/?$`,"i")}var f=Gj;var R=(j,J,b)=>{return{path:j,params:J,route:b}};async function t(j,J,b){let z;return new Promise(async(Z,H)=>{b.signal.addEventListener("abort",()=>H());for(let Q of j){if(b.signal.aborted)return;let Y={...J,data:z};try{z=await Q(Y,b)}catch(W){H(W)}}Z()})}var e=(j,J,b)=>{let z=f("notfound",{handlers:[(K)=>console.error(new ReferenceError(c(K.path)))],name:"notfound"}),Z=new Map([["notfound",z]]),H=R(b,{}),Q=null,Y=!1,W={name:j,version:J,history:r(),routes:Z,context:H,get loading(){return Y},set loading(K){if(Y==K)return;Y=K,document.dispatchEvent(new Event(K?"pinecone:start":"pinecone:end"))},settings:(K)=>u(K),add:function(K,G){if(K!="notfound"){if(K=B(K,$.basePath),this.routes.has(K))throw new Error(x(K))}if(G.templates&&($.preload||G.preload))k(G.templates);this.routes.set(K,f(K,G))},remove:function(K){this.routes.delete(K)},navigate:async function(K,G,F,q){if(Q)Q.abort();Q=new AbortController,this.loading=!0,K=B(K||"/",$.basePath);let X=this.routes.get("notfound"),C={};for(let[V,U]of this.routes){let A=U.match(K);if(A){C=A,X=U;break}}let M=R(K,C,X),L=$.globalHandlers.concat(X.handlers);if(L.length){try{await t(L,M,Q)}catch(V){this.loading=!1;return}if(!X.templates)this.loading=!1}if(q!=null)this.history.index=q,this.history.pushState(K,$.hash);else if(K!=this.context.path)this.history.push(K,!G&&!F,$.hash);if(this.context=M,X.programmaticTemplates){let V=document.getElementById(X.targetID??$.targetID??"");if(!V)throw new Error(g);let U=X.interpolate?D(X.templates,C):X.templates;I(U,V).finally(()=>this.loading=!1)}if(!X.templates)this.loading=!1}};return W.history.setRouter(W),W};var jj=(j)=>{window.document.body.addEventListener("click",(J)=>{if(J.ctrlKey||J.metaKey||J.altKey||J.shiftKey||J.button||J.defaultPrevented)return;let b=J.target.closest("a");if(!b)return;if($.handleClicks===!1&&!b.hasAttribute("x-link")||b.hasAttribute("data-native")||b.hasAttribute("native"))return;let z=b.getAttribute("href"),Z=b.getAttribute("target");if(z&&(!Z||/^_?self$/i.test(Z)))j.navigate(z),J.preventDefault()})};var bj="pinecone-router",zj="7.0.0-beta.6";var Wj=function(j){let J=$.hash?location.hash.substring(1):location.pathname,b=j.reactive(e(bj,zj,J));window.PineconeRouter=b,document.addEventListener("alpine:initialized",()=>{b.navigate(J,!1,!0)}),window.addEventListener("popstate",()=>{if($.hash){if(window.location.hash!="")b.navigate(window.location.hash.substring(1),!0)}else b.navigate(window.location.pathname,!0)}),jj(b),document.addEventListener("pinecone:end",()=>j.nextTick(o),{once:!0}),s(j,b),l(j,b),a(j,b),j.$router=b,j.magic("router",()=>b),j.magic("history",()=>b.history),j.magic("params",()=>b.context.params)},z1=Wj;export{z1 as default,Wj as PineconeRouterPlugin};

//# debugId=BB812FFA4854EFA464756E2164756E21
//# sourceMappingURL=router.esm.js.map
