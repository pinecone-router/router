var Kj=(j)=>`Invalid expression type. Expression: ${j}`,v=(j)=>`Can't find an element with target ID: ${j}`,A=(j)=>`Route already exists: ${j}`;var Zj=(j)=>`x-${j} must be used on the same template as x-route`,x="targetID must be specified for programmatically added templates",g=(j)=>`Path: ${j} was not found`;function k(j){if(j.tagName.toLowerCase()!=="template")throw new TypeError("Directives can only be used on template elements.")}function U(j){if(k(j),j._x_PineconeRouter_route===void 0)throw new TypeError(Zj("template"))}function y(j){if(typeof j!="object"||!Array.isArray(j))throw new TypeError(Kj(j))}var c=(j,J,z)=>{if(j.indexOf(J)===-1)return z;let K=j[j.indexOf(J)+1];if(!K)return z;if(J==="target"){let $=K.match(/([a-z0-9_-]+)/);if($)return $[1]}return K},B=(j,J)=>{if(j=="notfound")return j;if(!j.startsWith(J))j=J+j;return j},N=(j)=>{return/^\[.*\]$|^Array\(.*\)$/.test(j.trim())},d=(j,J)=>{let z=j??J??"",K=document.getElementById(z);if(z&&!K)throw new ReferenceError(v(z));return K??void 0};var Y={hash:!1,basePath:"",globalHandlers:[],handleClicks:!0,targetID:void 0,preload:!1},m=(j)=>{return Y={...Y,...j},Y};var I=new Set,S=new Map,O=new Map,T=new Set,h=(j,J)=>{document.dispatchEvent(new CustomEvent("pinecone:fetch-error",{detail:{error:j,url:J}}))},u=(j,J,z,K,$)=>{let Q=J.id+z;if(I.has(Q))return;I.add(Q);let H=J.content,G=Array(H.childElementCount);H.querySelectorAll("script").forEach((b)=>{let W=document.createElement("script");Array.from(b.attributes).forEach((F)=>W.setAttribute(F.name,F.value)),W.textContent=b.textContent,b.parentNode?.replaceChild(W,b)});let Z=Array.from(H.children);for(let b=0;b<Z.length;b++)G[b]=Z[b].cloneNode(!0),j.addScopeToNode(G[b],{},J);j.mutateDom(()=>{if(K)K.replaceChildren(...G);else J.after(...G);G.forEach((b)=>{j.initTree(b)})}),J._x_PineconeRouter_template=G,J._x_PineconeRouter_templateUrls=$,J._x_PineconeRouter_undoTemplate=()=>{j.mutateDom(()=>{G.forEach((b)=>{j.destroyTree(b),b.remove()})}),delete J._x_PineconeRouter_template,delete J._x_PineconeRouter_templateUrls},j.nextTick(()=>I.delete(Q))},P=(j)=>{if(j._x_PineconeRouter_undoTemplate)j._x_PineconeRouter_undoTemplate(),delete j._x_PineconeRouter_undoTemplate},p=async(j,J,z,K,$)=>{if(J._x_PineconeRouter_templateUrls!=null&&J._x_PineconeRouter_templateUrls!=K)P(J),J.innerHTML="";if(J._x_PineconeRouter_template)return;if(J.content.childElementCount){u(j,J,z,$,K);return}if(K)return _(K,J).then(()=>u(j,J,z,$,K))},w=(j,J)=>{return j.map((z)=>z.replace(/:([^/.]+)/g,(K,$)=>J[$]||$))},n=async(j,J="high")=>{if(j=B(j,Y.basePath),S.has(j))return S.get(j);if(O.has(j))return O.get(j);let z=fetch(j,{priority:J}).then((K)=>{if(!K.ok)return h(K.statusText,j),"";return K.text()}).then((K)=>{if(K)S.set(j,K);return O.delete(j),K||""}).catch((K)=>{if(K instanceof TypeError)h(K.message,j);return""});return O.set(j,z),z},D=(j,J)=>{T.add({urls:j,el:J})},i=()=>{for(let j of T){if(j.el)_(j.urls,j.el,"low");else j.urls.map((J)=>n(J,"low"));T.delete(j)}},_=(j,J,z="high")=>Promise.all(j.map((K)=>n(K,z))).then((K)=>{J.innerHTML=K.join("")});var $j=(j,J)=>{j.directive("template",(z,{expression:K,modifiers:$},{evaluate:Q,cleanup:H,Alpine:G,effect:Z})=>{U(z);let b=d(c($,"target"),Y.targetID),W=z._x_PineconeRouter_route,F,X=$.includes("interpolate");if(K!=""){if(!N(K))K=`['${K}']`;let M=Q(K);if(y(M),F=M,!X&&(Y.preload||$.includes("preload")))D(F,z);let q=J.routes.get(W);q.templates=F}let C=(M)=>{if(J.context.route?.path===W){if(M&&X)M=w(M,J.context.params);p(G,z,K,M,b).then(()=>{J.loading=!1})}else P(z)},L=Z(()=>C(F));H(()=>{z._x_PineconeRouter_undoTemplate&&z._x_PineconeRouter_undoTemplate(),G.release(L)})})},o=$j;var bj=(j,J)=>{j.directive("handler",(z,{expression:K,modifiers:$},{evaluate:Q,cleanup:H})=>{if(!N(K))K=`[${K}]`;let G=Q(K);y(G);let Z=G;for(let W=0;W<Z.length;W++)Z[W]=Z[W].bind(j.$data(z));let b;if($.includes("global"))Y.globalHandlers=Z;else{U(z);let W=z._x_PineconeRouter_route;b=J.routes.get(W),b.handlers=Z}H(()=>{if($.includes("global"))Y.globalHandlers=[];else b.handlers=[]})}).before("template")},s=bj;var Qj=(j,J)=>{j.directive("route",(z,{expression:K},{cleanup:$})=>{let Q=B(K,Y.basePath);if(k(z),Q!="notfound")J.add(Q,{});if(z._x_PineconeRouter_route=Q,z.content.childElementCount&&!Array.from(z.attributes).some((H)=>H.name.startsWith("x-template")))z.setAttribute("x-template","");$(()=>{J.routes.delete(Q),delete z._x_PineconeRouter_route})}).before("handler")},l=Qj;var a=()=>{return{entries:[],index:0,canGoBack:function(){return this.index>0},back:function(){this.to(this.index-1)},canGoForward:function(){return this.index<this.entries.length-1},forward:function(){this.to(this.index+1)},to:function(j){if(j in this.entries)this.router?.navigate(this.entries[j],!1,!1,j)},push:function(j,J,z){if(this.index<this.entries.length-1)this.entries=this.entries.slice(0,this.index+1);if(this.entries.push(j),this.index=this.entries.length-1,J)this.pushState(j,z)},pushState:function(j,J){let z=J&&!j.startsWith("#")?"#"+j:j;history.pushState({path:z},"",z)},setRouter(j){this.router=j}}};var Yj=(j,{targetID:J,templates:z=[],handlers:K=[],interpolate:$=!1,name:Q}={})=>({programmaticTemplates:z.length>0,pattern:Gj(j),interpolate:$,templates:z,targetID:J,handlers:K,name:Q,path:j,match(H){let G=this.pattern.exec(H);if(G)return{...G.groups}}});function Gj(j){let z=j.split("/").filter(Boolean).map((K)=>{if(!K.startsWith(":"))return"/"+K;let[,$,Q,H]=K.match(/^:(\w+)([?+*]?)(?:\.(.+))?$/)||[],G=Q==="*"||Q==="+",Z=Q==="?"||Q==="*",W=`(?<${$}>${G?Z?".*?":".+":"[^/]+?"})`,F=H?`\\.${H}`:"",X=W+F;if(Z)return`(?:/${X})?`;return`/${X}`}).join("");return new RegExp(`^${z}/?$`,"i")}var E=Yj;var f=(j,J,z)=>{return{path:j,params:J,route:z}};async function r(j,J,z){let K;return new Promise(async($,Q)=>{z.signal.addEventListener("abort",()=>Q());for(let H of j){if(z.signal.aborted)return;let G={...J,data:K};try{K=await H(G,z)}catch(Z){Q(Z)}}$()})}var t=(j,J)=>{let z=E("notfound",{handlers:[(Z)=>console.error(new ReferenceError(g(Z.path)))]}),K=new Map([["notfound",z]]),$=f("",{}),Q=null,H=!1,G={name:j,version:J,history:a(),routes:K,context:$,get loading(){return H},set loading(Z){if(H==Z)return;H=Z,document.dispatchEvent(new Event(Z?"pinecone:start":"pinecone:end"))},settings:(Z)=>m(Z),add:function(Z,b){if(Z!="notfound"){if(Z=B(Z,Y.basePath),this.routes.has(Z))throw new Error(A(Z))}if(b.templates&&(Y.preload||b.preload))D(b.templates);this.routes.set(Z,E(Z,b))},remove:function(Z){this.routes.delete(Z)},navigate:async function(Z,b,W,F){if(Q)Q.abort();Q=new AbortController,this.loading=!0,Z=B(Z||"/",Y.basePath);let X=this.routes.get("notfound"),C={};for(let[q,V]of this.routes){let R=V.match(Z);if(R){C=R,X=V;break}}let L=f(Z,C,X),M=Y.globalHandlers.concat(X.handlers);if(M.length){try{await r(M,L,Q)}catch(q){this.loading=!1;return}if(!X.templates)this.loading=!1}if(F!=null)this.history.index=F,this.history.pushState(Z,Y.hash);else if(Z!=this.context.path)this.history.push(Z,!b&&!W,Y.hash);if(this.context=L,X.programmaticTemplates){let q=document.getElementById(X.targetID??Y.targetID??"");if(!q)throw new Error(x);let V=X.interpolate?w(X.templates,C):X.templates;_(V,q).finally(()=>this.loading=!1)}if(!X.templates)this.loading=!1}};return G.history.setRouter(G),G};var e=(j)=>{window.document.body.addEventListener("click",(J)=>{if(J.ctrlKey||J.metaKey||J.altKey||J.shiftKey||J.button||J.defaultPrevented)return;let z=J.target.closest("a");if(!z)return;if(Y.handleClicks===!1&&!z.hasAttribute("x-link")||z.hasAttribute("data-native")||z.hasAttribute("native"))return;let K=z.getAttribute("href"),$=z.getAttribute("target");if(K&&(!$||/^_?self$/i.test($)))j.navigate(K),J.preventDefault()})};var Jj="pinecone-router",zj="7.0.0-beta.4";var Hj=function(j){let J=j.reactive(t(Jj,zj));window.PineconeRouter=J,document.addEventListener("alpine:initialized",()=>{if(Y.hash==!1)J.navigate(location.pathname+location.search,!1,!0);else J.navigate(location.hash.substring(1),!1,!0)}),window.addEventListener("popstate",()=>{if(Y.hash){if(window.location.hash!="")J.navigate(window.location.hash.substring(1),!0)}else J.navigate(window.location.pathname,!0)}),e(J),document.addEventListener("pinecone:end",()=>j.nextTick(i),{once:!0}),o(j,J),s(j,J),l(j,J),j.$router=J,j.magic("router",()=>J),j.magic("history",()=>J.history),j.magic("params",()=>J.context.params)},z1=Hj;export{z1 as default,Hj as PineconeRouterPlugin};

//# debugId=C0166287EDF6137764756E2164756E21
//# sourceMappingURL=router.esm.js.map
