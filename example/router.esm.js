var A=()=>{return{entries:[],index:0,canGoBack:function(){return this.index>0},back:function(){this.to(this.index-1)},canGoForward:function(){return this.index<this.entries.length-1},forward:function(){this.to(this.index+1)},to:function(b){if(b in this.entries)this.router?.navigate(this.entries[b],!1,!1,b)},push:function(b,j,z){if(this.index<this.entries.length-1)this.entries=this.entries.slice(0,this.index+1);if(this.entries.push(b),this.index=this.entries.length-1,j)this.pushState(b,z)},pushState:function(b,j){let z=j?"#"+b:b;history.pushState({path:z},"",z)},setRouter(b){this.router=b}}};var N=(b,j,z)=>{return{path:b,route:z,params:j}};function V(b,{targetID:j,templates:z=[],handlers:J=[],interpolate:Z=!1}={}){return{programmaticTemplates:z.length>0,pattern:J2(b),interpolate:Z,templates:z,targetID:j,handlers:J,path:b,match(Y){let H=this.pattern.exec(Y);if(H)return{...H.groups}}}}function J2(b){let j,z,J,Z="",G=b.split("/");G[0]||G.shift();while(z=G.shift())if(z.startsWith(":")){j=z.indexOf("?",1),J=z.indexOf(".",1);let Y=z.substring(1,Math.min(...[j,J,z.length].filter((K)=>K>0))),H=Y.endsWith("*")||Y.endsWith("+"),$=Y.endsWith("*");if(H)Y=Y.slice(0,-1),Z+=$?`(?:/(?<${Y}>.*)?)?`:`/(?<${Y}>.+)`;else if(Z+=j>0&&J<0?`(?:/(?<${Y}>[^/]+?))?`:`/(?<${Y}>[^/]+?)`,J>0)Z+=(j>0?"?":"")+"\\"+z.substring(J)}else Z+="/"+z;return new RegExp("^"+Z+"/?$","i")}var q={hash:!1,basePath:"",globalHandlers:[],handleClicks:!0,targetID:void 0,preload:!1},R=(b)=>{return q={...q,...b},q};var z2=(b)=>`Invalid expression type. Expression: ${b}.`,g=(b)=>`Can't find an element with the supplied target ID: ${b}`,c=(b)=>`Route already exists: ${b}`;var K2="Directives can only be used on template elements.",Z2=(b)=>`x-${b} must be used on the same template as x-route.`,x="targetID must be specified for programmatically added templates.",d=(b)=>`Path: ${b} was not found.`;function S(b){if(b.tagName.toLowerCase()!=="template")throw new TypeError(K2)}function U(b){if(S(b),b._x_PineconeRouter_route===void 0)throw new TypeError(Z2("template"))}function O(b){if(typeof b!="object"||!Array.isArray(b))throw new TypeError(z2(b))}var m=(b,j,z)=>{if(b.indexOf(j)===-1)return z;let J=b[b.indexOf(j)+1];if(!J)return z;if(j==="target"){let Z=J.match(/([a-z0-9_-]+)/);if(Z)return Z[1]}return J},M=(b,j)=>{if(b=="notfound")return b;if(!b.startsWith(j))b=j+b;return b},h=(b,j)=>{let z=b??j??"",J=document.getElementById(z);if(z.length&&!J)throw new ReferenceError(g(z));return J??void 0};var P=new Set,T=new Map,w=new Map,I=new Set,$2=(b,j)=>{document.dispatchEvent(new CustomEvent("pinecone:fetch-error",{detail:{error:b,url:j}}))},u=(b,j,z,J,Z)=>{let G=j.id+z;if(P.has(G))return;P.add(G);let Y=j.content,H=Array(Y.childElementCount);Y.querySelectorAll("script").forEach(($)=>{let K=document.createElement("script");Array.from($.attributes).forEach((Q)=>K.setAttribute(Q.name,Q.value)),K.textContent=$.textContent,$.parentNode?.replaceChild(K,$)}),Array.from(Y.children).forEach(($,K)=>{let Q=$.cloneNode(!0);H[K]=Q,b.addScopeToNode(Q,{},j)}),b.mutateDom(()=>{if(J)J.replaceChildren(...H);else j.after(...H);H.forEach(($)=>{b.initTree($)})}),j._x_PineconeRouter_template=H,j._x_PineconeRouter_templateUrls=Z,j._x_PineconeRouter_undoTemplate=()=>{b.mutateDom(()=>{H.forEach(($)=>{b.destroyTree($),$.remove()})}),delete j._x_PineconeRouter_template,delete j._x_PineconeRouter_templateUrls},b.nextTick(()=>P.delete(G))},f=(b)=>{if(b._x_PineconeRouter_undoTemplate)b._x_PineconeRouter_undoTemplate(),delete b._x_PineconeRouter_undoTemplate},i=async(b,j,z,J,Z)=>{if(j._x_PineconeRouter_templateUrls!=null&&j._x_PineconeRouter_templateUrls!=J)f(j),j.innerHTML="";if(j._x_PineconeRouter_template)return;if(j.content.childElementCount){u(b,j,z,Z,J);return}if(J)return _(J,j).then(()=>u(b,j,z,Z,J))},D=(b,j)=>{return b.map((z)=>z.replace(/:([^/.]+)/g,(J,Z)=>j[Z]||Z))},n=async(b,j="high")=>{if(b=M(b,q.basePath),T.has(b))return T.get(b);if(w.has(b))return w.get(b);let z=fetch(b,{priority:j}).then((J)=>{if(!J.ok)return $2(J.statusText,b),"";return J.text()}).then((J)=>{if(J)T.set(b,J);return w.delete(b),J||""});return w.set(b,z),z},k=(b,j)=>{I.add({urls:b,el:j})},p=()=>{for(let b of I){if(b.el)_(b.urls,b.el,"low");else b.urls.map((j)=>n(j,"low"));I.delete(b)}},_=(b,j,z="high")=>Promise.all(b.map((J)=>n(J,z))).then((J)=>{j.innerHTML=J.join("")});async function o(b,j,z){let J;return new Promise(async(Z,G)=>{z.signal.addEventListener("abort",()=>G());for(let Y of b){if(z.signal.aborted)return;let H={...j,data:J};try{J=await Y(H,z)}catch($){G($)}}Z()})}var s=(b,j,z)=>{let J=V("notfound",{handlers:[(K)=>console.error(new ReferenceError(d(K.path)))]}),Z=new Map([["notfound",J]]),G=N("",{},""),Y=null,H=!1,$={name:j,version:z,history:A(),routes:Z,context:G,get loading(){return H},set loading(K){if(H==K)return;H=K,document.dispatchEvent(new Event(K?"pinecone:start":"pinecone:end"))},settings:(K)=>R(K),add:function(K,Q){if(K!="notfound"){if(K=M(K,q.basePath),this.routes.has(K))throw new Error(c(K))}if(Q.templates&&(q.preload||Q.preload))k(Q.templates);this.routes.set(K,V(K,Q))},remove:function(K){this.routes.delete(K)},navigate:async function(K,Q,W,X){if(Y)Y.abort();Y=new AbortController,K=M(K||"/",q.basePath);let y=this.routes.get("notfound"),F={};for(let[C,L]of this.routes){let v=L.match(K);if(v){F=v,y=L;break}}let B=N(K,F,y.path),E=q.globalHandlers.concat(y.handlers);if(this.loading=!0,E.length){try{await o(E,B,Y)}catch(C){this.loading=!1;return}if(!y.templates)this.loading=!1}if(X!=null)this.history.index=X,this.history.pushState(K,q.hash);else if(K!=this.context.path)this.history.push(K,!Q&&!W,q.hash);if(this.context=B,y.programmaticTemplates){let C=document.getElementById(y.targetID??q.targetID??"");if(!C)throw new Error(x);let L=y.interpolate?D(y.templates,F):y.templates;_(L,C).finally(()=>this.loading=!1)}if(!y.templates)this.loading=!1}};return $.history.setRouter($),$};var Y2=(b,j)=>{b.directive("template",(z,{expression:J,modifiers:Z},{evaluate:G,cleanup:Y,Alpine:H,effect:$})=>{U(z);let K=h(m(Z,"target"),q.targetID),Q=z._x_PineconeRouter_route,W,X=Z.includes("interpolate");if(J!=""){if(J=J.trim(),!(J.startsWith("[")&&J.endsWith("]"))&&!(J.startsWith("Array")&&J.endsWith(")")))J=`['${J}']`;let F=G(J);if(O(F),W=F,!X&&(q.preload||Z.includes("preload")))k(W,z);let B=j.routes.get(Q);B.templates=W}let y=(F)=>{if(j.context.route===Q){if(F&&X)F=D(F,j.context.params);i(H,z,J,F,K).then(()=>{j.loading=!1})}else f(z)};$(()=>y(W)),Y(()=>{z._x_PineconeRouter_undoTemplate&&z._x_PineconeRouter_undoTemplate()})})},l=Y2;var G2=(b,j)=>{b.directive("handler",(z,{expression:J,modifiers:Z},{evaluate:G,cleanup:Y})=>{if(J=J.trim(),!(J.startsWith("[")&&J.endsWith("]"))&&!(J.startsWith("Array")&&J.endsWith(")")))J=`[${J}]`;let H=G(J);O(H);let $=H;for(let Q=0;Q<$.length;Q++)$[Q]=$[Q].bind(b.$data(z));let K;if(Z.includes("global"))j.settings.globalHandlers=$;else{U(z);let Q=z._x_PineconeRouter_route;K=j.routes.get(Q),K.handlers=$}Y(()=>{if(Z.includes("global"))j.settings.globalHandlers=[];else K.handlers=[]})}).before("template")},a=G2;var H2=(b,j)=>{b.directive("route",(z,{expression:J},{cleanup:Z})=>{let G=M(J,q.basePath);if(S(z),G!="notfound")j.add(G,{});z._x_PineconeRouter_route=G,Z(()=>{j.routes.delete(G),delete z._x_PineconeRouter_route})}).before("handler")},r=H2;var t=(b)=>{window.document.body.addEventListener("click",(j)=>{if(j.ctrlKey||j.metaKey||j.altKey||j.shiftKey||j.button||j.defaultPrevented)return;let z=j.target.closest("a");if(!z)return;if(b.settings.handleClicks===!1&&!z.hasAttribute("x-link")||z.hasAttribute("data-native")||z.hasAttribute("native"))return;let J=z.getAttribute("href"),Z=z.getAttribute("target");if(J&&(!Z||/^_?self$/i.test(Z)))b.navigate(J),j.preventDefault()})};var b2="pinecone-router";var j2="7.0.0";var Q2=function(b){let j=b.reactive(s(b,b2,j2));window.PineconeRouter=j,document.addEventListener("alpine:initialized",()=>{if(q.hash==!1)j.navigate(location.pathname+location.search,!1,!0);else j.navigate(location.hash.substring(1),!1,!0)}),window.addEventListener("popstate",()=>{if(q.hash){if(window.location.hash!="")j.navigate(window.location.hash.substring(1),!0)}else j.navigate(window.location.pathname,!0)}),t(j),document.addEventListener("pinecone:end",()=>b.nextTick(p),{once:!0}),l(b,j),a(b,j),r(b,j),b.$router=j,b.magic("router",()=>j),b.magic("history",()=>j.history),b.magic("params",()=>j.context.params)},e2=Q2;export{e2 as default};

//# debugId=7BABBCA4C6092E2264756E2164756E21
//# sourceMappingURL=router.esm.js.map
