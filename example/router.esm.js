var v=()=>{return{entries:[],index:0,canGoBack:function(){return this.index>0},back:function(){this.to(this.index-1)},canGoForward:function(){return this.index<this.entries.length-1},forward:function(){this.to(this.index+1)},to:function(b){if(b in this.entries)this.router?.navigate(this.entries[b],!1,!1,b)},push:function(b,j,z){if(this.index<this.entries.length-1)this.entries=this.entries.slice(0,this.index+1);if(this.entries.push(b),this.index=this.entries.length-1,j)this.pushState(b,z)},pushState:function(b,j){let z=j?"#"+b:b;history.pushState({path:z},"",z)},setRouter(b){this.router=b}}};var k=(b,j,z)=>{return{path:b,route:z,params:j}};function V(b,{targetID:j,templates:z=[],handlers:J=[]}={}){return{programmaticTemplates:z.length>0,targetID:j,templates:z,handlers:J,pattern:J2(b),path:b,match(y){let $=this.pattern.exec(y);if($)return{...$.groups}}}}function J2(b){let j,z,J,Z="",y=b.split("/");y[0]||y.shift();while(z=y.shift())if(z.startsWith(":")){j=z.indexOf("?",1),J=z.indexOf(".",1);let $=z.substring(1,Math.min(...[j,J,z.length].filter((K)=>K>0))),G=$.endsWith("*")||$.endsWith("+"),Y=$.endsWith("*");if(G)$=$.slice(0,-1),Z+=Y?`(?:/(?<${$}>.*)?)?`:`/(?<${$}>.+)`;else if(Z+=j>0&&J<0?`(?:/(?<${$}>[^/]+?))?`:`/(?<${$}>[^/]+?)`,J>0)Z+=(j>0?"?":"")+"\\"+z.substring(J)}else Z+="/"+z;return new RegExp("^"+Z+"/?$","i")}var H={hash:!1,basePath:"/",globalHandlers:[],handleClicks:!0,targetID:void 0,preload:!1},A=(b)=>{H={...H,...b}};var z2=(b)=>`Invalid expression type. Expression: ${b}.`,g=(b)=>`Can't find an element with the supplied target ID: ${b}`,R=(b)=>`Route already exists: ${b}`;var K2="Directives can only be used on template elements.",Z2=(b)=>`x-${b} must be used on the same template as x-route.`,c="targetID must be specified for programmatically added templates.",x=(b)=>`Path: ${b} was not found.`;function _(b){if(b.tagName.toLowerCase()!=="template")throw new TypeError(K2)}function C(b){if(_(b),b._x_PineconeRouter_route===void 0)throw new TypeError(Z2("template"))}function L(b){if(typeof b!="object"||!Array.isArray(b))throw new TypeError(z2(b))}var d=(b,j,z)=>{if(b.indexOf(j)===-1)return z;let J=b[b.indexOf(j)+1];if(!J)return z;if(j==="target"){let Z=J.match(/([a-z0-9_-]+)/);if(Z)return Z[1]}return J},U=(b,j)=>{if(b=="notfound")return b;if(j!="/"&&!b.startsWith(j))b=j+b;return b},m=(b,j)=>{let z=b??j??"",J=document.getElementById(z);if(z.length&&!J)throw new ReferenceError(g(z));return J??void 0};var N=new Set,S=new Map,O=new Map,P=new Set,Y2=(b,j)=>{document.dispatchEvent(new CustomEvent("pinecone:fetch-error",{detail:{error:b,url:j}}))},h=(b,j,z,J,Z)=>{let y=j.id+z;if(N.has(y))return;N.add(y);let $=j.content,G=Array($.childElementCount);$.querySelectorAll("script").forEach((Y)=>{let K=document.createElement("script");Array.from(Y.attributes).forEach((B)=>K.setAttribute(B.name,B.value)),K.textContent=Y.textContent,Y.parentNode?.replaceChild(K,Y)}),Array.from($.children).forEach((Y,K)=>{let B=Y.cloneNode(!0);G[K]=B,b.addScopeToNode(B,{},j)}),b.mutateDom(()=>{if(J)J.replaceChildren(...G);else j.after(...G);G.forEach((Y)=>{b.initTree(Y)})}),j._x_PineconeRouter_template=G,j._x_PineconeRouter_templateUrls=Z,j._x_PineconeRouter_undoTemplate=()=>{b.mutateDom(()=>{G.forEach((Y)=>{b.destroyTree(Y),Y.remove()})}),delete j._x_PineconeRouter_template,delete j._x_PineconeRouter_templateUrls},b.nextTick(()=>N.delete(y))},T=(b)=>{if(b._x_PineconeRouter_undoTemplate)b._x_PineconeRouter_undoTemplate(),delete b._x_PineconeRouter_undoTemplate},u=async(b,j,z,J,Z)=>{if(j._x_PineconeRouter_templateUrls!=null&&j._x_PineconeRouter_templateUrls!=J)T(j),j.innerHTML="";if(j._x_PineconeRouter_template)return;if(j.content.childElementCount){h(b,j,z,Z,J);return}if(J)return D(J,j).then(()=>h(b,j,z,Z,J))},i=(b,j)=>{return b.map((z)=>z.replace(/:([^/.]+)/g,(J,Z)=>j[Z]||Z))},n=async(b,j="high")=>{if(b=U(b,H.basePath),S.has(b))return S.get(b);if(O.has(b))return O.get(b);let z=fetch(b,{priority:j}).then((J)=>{if(!J.ok)return Y2(J.statusText,b),"";return J.text()}).then((J)=>{if(J)S.set(b,J);return O.delete(b),J||""});return O.set(b,z),z},w=(b,j)=>{b.forEach((z)=>P.add({url:z,el:j}))},p=()=>{for(let b of P){if(b.el)D([b.url],b.el,"low");else n(b.url,"low");P.delete(b)}},D=(b,j,z="high")=>Promise.all(b.map((J)=>n(J,z))).then((J)=>{j.innerHTML=J.join("")});async function s(b,j,z){let J;return new Promise(async(Z,y)=>{z.signal.addEventListener("abort",()=>y());for(let $ of b){if(z.signal.aborted)return;let G={...j,data:J};try{J=await $(G,z)}catch(Y){y(Y)}}Z()})}var o=(b,j,z)=>{let J=V("notfound",{handlers:[(K)=>console.error(new ReferenceError(x(K.path)))]}),Z=new Map([["notfound",J]]),y=k("",{},""),$=null,G=!1,Y={name:j,version:z,history:v(),routes:Z,context:y,get loading(){return G},set loading(K){if(G==K)return;G=K,document.dispatchEvent(new Event(K?"pinecone:start":"pinecone:end"))},get settings(){return H},set settings(K){A(K)},add:function(K,B){if(K!="notfound"){if(this.routes.has(K))throw new Error(R(K))}if(B.templates&&(H.preload||B.preload))w(B.templates);this.routes.set(K,V(K,B))},remove:function(K){this.routes.delete(K)},navigate:async function(K,B,F,M){if($)$.abort();if($=new AbortController,K=U(K||"/",H.basePath),F&&H.hash&&K==="/")return this.navigate("/",!1,!1);let Q=this.routes.get("notfound"),q={};for(let[W,f]of this.routes){let E=f.match(K);if(E){q=E,Q=f;break}}let X=k(K,q,Q.path),I=H.globalHandlers.concat(Q.handlers);if(this.loading=!0,I.length){try{await s(I,X,$)}catch(W){this.loading=!1;return}if(!Q.templates)this.loading=!1}if(M!=null)this.history.index=M,this.history.pushState(K,H.hash);else if(K!=this.context.path)this.history.push(K,!B&&!F,H.hash);if(this.context=X,Q.programmaticTemplates){let W=document.getElementById(Q.targetID??H.targetID??"");if(!W)throw new Error(c);D(Q.templates,W).finally(()=>this.loading=!1)}if(!Q.templates)this.loading=!1}};return document.addEventListener("pinecone:start",()=>{Y.loading=!0}),document.addEventListener("pinecone:end",()=>{Y.loading=!1}),Y.history.setRouter(Y),Y};var $2=(b,j)=>{b.directive("template",(z,{expression:J,modifiers:Z},{evaluate:y,cleanup:$,Alpine:G,effect:Y})=>{C(z);let K=m(d(Z,"target"),j.settings.targetID),B=z._x_PineconeRouter_route,F,M=Z.includes("interpolate");if(J!=""){if(J=J.trim(),!(J.startsWith("[")&&J.endsWith("]"))&&!(J.startsWith("Array")&&J.endsWith(")")))J=`['${J}']`;let q=y(J);if(L(q),F=q,!M&&(H.preload||Z.includes("preload")))w(F,z);let X=j.routes.get(B);X.templates=F}let Q=(q)=>{if(j.context.route===B){if(q&&M)q=i(q,j.context.params);u(G,z,J,q,K).then(()=>{console.log("shown template"),j.loading=!1})}else T(z)};Y(()=>Q(F)),$(()=>{z._x_PineconeRouter_undoTemplate&&z._x_PineconeRouter_undoTemplate()})})},l=$2;var y2=(b,j)=>{b.directive("handler",(z,{expression:J,modifiers:Z},{evaluate:y,cleanup:$})=>{if(J=J.trim(),!(J.startsWith("[")&&J.endsWith("]"))&&!(J.startsWith("Array")&&J.endsWith(")")))J=`[${J}]`;let G=y(J);L(G);let Y=G;for(let B=0;B<Y.length;B++)Y[B]=Y[B].bind(b.$data(z));let K;if(Z.includes("global"))j.settings.globalHandlers=Y;else{C(z);let B=z._x_PineconeRouter_route;K=j.routes.get(B),K.handlers=Y}$(()=>{if(Z.includes("global"))j.settings.globalHandlers=[];else K.handlers=[]})}).before("template")},a=y2;var B2=(b,j)=>{b.directive("route",(z,{expression:J},{cleanup:Z})=>{let y=J;if(_(z),y!="notfound")j.add(y,{});z._x_PineconeRouter_route=y,Z(()=>{j.routes.delete(y),delete z._x_PineconeRouter_route})}).before("handler")},r=B2;var t=(b)=>{window.document.body.addEventListener("click",(j)=>{if(j.ctrlKey||j.metaKey||j.altKey||j.shiftKey||j.button||j.defaultPrevented)return;let z=j.target.closest("a");if(!z)return;if(b.settings.handleClicks===!1&&!z.hasAttribute("x-link")||z.hasAttribute("data-native")||z.hasAttribute("native"))return;let J=z.getAttribute("href"),Z=z.getAttribute("target");if(J&&J.startsWith(b.settings.basePath)&&(!Z||/^_?self$/i.test(Z)))b.navigate(J),j.preventDefault()})};var b2="pinecone-router";var j2="7.0.0";var G2=function(b){let j=b.reactive(o(b,b2,j2));window.PineconeRouter=j,document.addEventListener("alpine:initialized",()=>{if(j.settings.hash==!1)j.navigate(location.pathname+location.search,!1,!0);else j.navigate(location.hash.substring(1),!1,!0)}),window.addEventListener("popstate",()=>{if(j.settings.hash){if(window.location.hash!="")j.navigate(window.location.hash.substring(1),!0)}else j.navigate(window.location.pathname,!0)}),t(j),document.addEventListener("pinecone:end",()=>b.nextTick(p),{once:!0}),l(b,j),a(b,j),r(b,j),b.magic("router",()=>j),b.magic("history",()=>j.history),b.magic("params",()=>j.context.params)},a2=G2;export{a2 as default};

//# debugId=668F6D8C23BB5AC264756E2164756E21
//# sourceMappingURL=router.esm.js.map
