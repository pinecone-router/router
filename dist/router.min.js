(()=>{var A=class{constructor(e,a={}){this.params={};this.handlers=[];this.handlersDone=!1;this.path=e,Object.keys(a).forEach(u=>{this[u]=a[u]})}},M=A;var I=window.location;function C(o){return o.replace(/(^\/+|\/+$)/g,"").split("/")}function S(o,e){let a=/(?:\?([^#]*))?(#.*)?$/,u=o.match(a),v={},x;if(u&&u[1]){let d=u[1].split("&");for(let w=0;w<d.length;w++){let m=d[w].split("=");v[decodeURIComponent(m[0])]=decodeURIComponent(m.slice(1).join("="))}}let b=C(o.replace(a,"")),p=C(e||""),T=Math.max(b.length,p.length);for(let d=0;d<T;d++)if(p[d]&&p[d].charAt(0)===":"){let w=p[d].replace(/(^:|[+*?]+$)/g,""),m=(p[d].match(/[+*?]+$/)||{}).toString()[0],L=~m.indexOf("+"),c=~m.indexOf("*"),H=b[d]||"";if(!H&&!c&&(m.indexOf("?")<0||L)){x=!1;break}if(v[w]=decodeURIComponent(H),L||c){v[w]=b.slice(d).map(decodeURIComponent).join("/");break}}else if(p[d]!==b[d]){x=!1;break}return x===!1?!1:v}function j(o){if(typeof URL=="function"&&I)return new URL(o,window.location.toString());var e=window.document.createElement("a");return e.href=o,e}function N(o){if(!o||!I)return!1;var e=j(o),a=window.location;return a.protocol===e.protocol&&a.hostname===e.hostname&&(a.port===e.port||a.port===""&&(e.port=="80"||e.port=="443"))}function B(o){if(!I)return!1;var e=window.location;return o.pathname===e.pathname&&o.search===e.search}function U(o,e){let a={valid:!1,link:""};for(;o&&o.nodeName.toUpperCase()!=="A";)o=o.parentNode;if(!o||o.nodeName.toUpperCase()!=="A")return a;var u=typeof o.href=="object"&&o.href.constructor.name==="SVGAnimatedString";return o.hasAttribute("download")||o.getAttribute("rel")==="external"||(a.link=o.getAttribute("href")??"",!e&&B(o)&&(o.hash||a.link==="#"))||a.link&&a.link.indexOf("mailto:")>-1||(u?o.target.baseVal:o.target)||!u&&!N(o.href)||(a.valid=!0),a}function P(o,...e){if(!!window.PineconeRouterMiddlewares)for(let a in window.PineconeRouterMiddlewares){let u=window.PineconeRouterMiddlewares[a];if(u[o]==null)return;if(u[o](...e)=="stop")return"stop"}}function $(o){document.dispatchEvent(new CustomEvent("fetch-error",{detail:o}))}function D(o){let e=o.reactive({version:"4.0.1",name:"pinecone-router",settings:{hash:!1,basePath:"/",templateTargetId:null},notfound:new M("notfound"),routes:[],context:{route:"",path:"",params:{},query:window.location.search.substring(1),hash:window.location.hash.substring(1),redirect(t){return c(t),"stop"},navigate(t){c(t)}},add(t,r){if(this.routes.find(i=>i.path==t)!=null)throw new Error("Pinecone Router: route already exist");return this.routes.push(new M(t,r))-1},remove(t){this.routes=this.routes.filter(r=>r.path!=t)},loadStart:new Event("pinecone-start"),loadEnd:new Event("pinecone-end")});window.PineconeRouter=e;var a={},u={};let v=(t,r,i)=>(a[r]?a[r].then(n=>{i==null&&(t.innerHTML=n)}):a[r]=fetch(r).then(n=>{if(n.ok)return n.text();throw new Error(String(n.status))}).then(n=>(u[r]=n,i==null&&(t.innerHTML=n),n)).catch(n=>($(n),null)),a[r]),x=(t,r,i)=>{let n=r!=null?`PineconeRouter.routes[${r}]`:"PineconeRouter.notfound",s=`$router.route == "${i}" && ${n}.handlersDone`;t.hasAttribute("x-if")||(t.setAttribute("x-if",s),d())},b=t=>{!t.hasAttribute("x-if")||t.removeAttribute("x-if")},p=(t,r)=>{d(),t.innerHTML=u[r]},T=()=>{document.dispatchEvent(e.loadStart)},d=()=>{document.dispatchEvent(e.loadEnd)},w=t=>!e.settings.hash&&e.settings.basePath!="/"?e.settings.basePath+t:t,m=t=>e.routes.findIndex(r=>r.path==t);o.directive("route",(t,{expression:r},{cleanup:i})=>{let n=r;if(P("onBeforeRouteProcessed",t,n),n.indexOf("#")>-1)throw new Error("Pinecone Router: A route's path may not have a hash character.");let s=null;if(n!="notfound"&&(n=w(n),s=e.add(n)),t.content.firstElementChild!=null){let l=e.routes[s]??e.notfound;x(t,s,n)}P("onAfterRouteProcessed",t,n),i(()=>{e.remove(n),b(t)})}),o.directive("handler",(t,{expression:r},{evaluate:i,cleanup:n})=>{if(!t.hasAttribute("x-route"))throw new Error("Pinecone Router: x-handler must be set on the same element as x-route.");let s;!(r.startsWith("[")&&r.endsWith("]"))&&!(r.startsWith("Array(")&&r.endsWith(")"))&&(r=`[${r}]`);let l=i(r),h=t.getAttribute("x-route");if(typeof l=="object")s=l;else throw new Error(`Pinecone Router: Invalid handler type: ${typeof l}.`);let f;if(h=="notfound")f=e.notfound;else{h=w(h);let g=m(h);f=e.routes[g]}f.handlers=s,n(()=>{f.handlers=[],f.handlersDone=!0})}),o.directive("template",(t,{modifiers:r,expression:i},{Alpine:n,effect:s,cleanup:l})=>{if(!t.hasAttribute("x-route"))throw new Error("Pinecone Router: x-template must be used on the same element as x-route.");var h;let f=i,g=O(r,"target",null)??window.PineconeRouter.settings.templateTargetId,k=document.getElementById(g);if(g&&!k)throw new Error("Pinecone Router: Can't find an element with the suplied x-template target ID ("+g+")");r.includes("preload")&&(h=v(t,f,g).finally(()=>{h=!1,u[f]!=null&&(g||x(t,R,E))}));let E=t.getAttribute("x-route"),y,R;E=="notfound"?(e.notfound.template=f,y=e.notfound):(E=w(E),R=m(E),e.routes[R].template=f,y=e.routes[R]),n.nextTick(()=>{s(()=>{if(y.handlersDone&&e.context.route==E)if(u[f]!=null)if(g)p(k,f);else{if(d(),t.content.firstElementChild)return;t.innerHTML=u[f]}else h?h.finally(()=>{u[f]!=null&&g&&p(k,f)}):v(t,f,g).finally(()=>{u[f]!=null&&(g?p(k,f):x(t,R,E))})})}),l(()=>{delete u[y.template],y.template="",b(t)})}),o.$router=e.context,o.magic("router",()=>e.context),document.addEventListener("alpine:initialized",()=>{P("init"),e.settings.hash?c(location.hash.substring(1),!1,!0):c(location.pathname,!1,!0)}),window.addEventListener("popstate",()=>{e.settings.hash?window.location.hash!=""&&c(window.location.hash.substring(1),!0):c(window.location.pathname,!0)}),L();function L(){window.document.body.addEventListener(document.ontouchstart?"touchstart":"click",function(t){if(t.metaKey||t.ctrlKey||t.shiftKey||t.detail!=1||t.defaultPrevented)return;let r=t.target,i=t.composedPath();if(i){for(let l=0;l<i.length;l++)if(!!i[l].nodeName&&i[l].nodeName.toUpperCase()==="A"&&!!i[l].href){r=i[l];break}}if(r==null||r.hasAttribute("native"))return;let n=U(r,e.settings.hash);if(!n.valid)return;let s=e.routes[m(e.context.route)]??e.notfound;s.handlersDone||(s.cancelHandlers=!0,d()),t.stopImmediatePropagation&&t.stopImmediatePropagation(),t.stopPropagation&&t.stopPropagation(),t.preventDefault(),c(n.link)})}async function c(t,r=!1,i=!1){t||(t="/"),e.context.path=t,e.settings.hash||(e.settings.basePath!="/"&&!t.startsWith(e.settings.basePath)&&(t=e.settings.basePath+t),t==e.settings.basePath&&!t.endsWith("/")&&(t+="/"));let n=e.routes.find(l=>{let h=S(t,l.path);return l.params=h!=!1?h:{},h!=!1})??e.notfound;n.handlersDone=!n.handlers.length,(n.handlers.length||n.template)&&T();let s=H(n.path,t,n.params);if(e.context=s,P("onBeforeHandlersExecuted",n,t,i)=="stop"){d();return}if(!r){let l="";if(e.settings.hash?(l="#",l+=window.location.search+t):l=t+window.location.search+window.location.hash,!i)history.pushState({path:l},"",l);else if(e.settings.hash&&t=="/")return e.context=s,c("/",!1,!1)}if(n&&n.handlers.length){if(n.cancelHandlers=!1,!await W(n.handlers,s)){d();return}n.handlersDone=!0,n.template||d()}P("onHandlersExecuted",n,t,i)}function H(t,r,i){return{route:t,path:r,params:i,query:window.location.search.substring(1),hash:window.location.hash.substring(1),redirect(n){return c(n),"stop"},navigate(n){c(n)}}}function O(t,r,i){if(t.indexOf(r)===-1)return i;let n=t[t.indexOf(r)+1];if(!n)return i;if(r==="target"){let s=n.match(/([a-z0-9_-]+)/);if(s)return s[1]}return n}async function W(t,r){for(let i=0;i<t.length;i++)if(typeof t[i]=="function"){let n=e.routes[m(r.route)]??e.notfound;if(n.cancelHandlers)return n.cancelHandlers=!1,!1;let s;if(t[i].constructor.name==="AsyncFunction"?s=await t[i](r):s=t[i](r),s=="stop")return!1}return!0}}document.addEventListener("alpine:init",()=>{window.Alpine.plugin(D)});})();
//# sourceMappingURL=router.min.js.map
