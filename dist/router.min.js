(()=>{var k=class{params={};path;handlers=[];constructor(n,d={}){this.path=n,Object.keys(d).forEach(u=>{this[u]=d[u]}),d.templates&&(this.programmaticTemplates=!0)}templates=[];templateTargetId="";programmaticTemplates=!1;handlersDone=!1;preload=!1;cancelHandlers},H=k;function S(l){return l.replace(/(^\/+|\/+$)/g,"").split("/")}function C(l,n){let d=/(?:\?([^#]*))?(#.*)?$/,u=l.match(d),p={},_;if(u&&u[1]){let c=u[1].split("&");for(let f=0;f<c.length;f++){let x=c[f].split("=");p[decodeURIComponent(x[0])]=decodeURIComponent(x.slice(1).join("="))}}let P=S(l.replace(d,"")),w=S(n||""),T=Math.max(P.length,w.length);for(let c=0;c<T;c++)if(w[c]&&w[c].charAt(0)===":"){let f=w[c].replace(/(^:|[+*?]+$)/g,""),x=(w[c].match(/[+*?]+$/)||{}).toString()[0],v=~x.indexOf("+"),y=~x.indexOf("*"),m=P[c]||"";if(!m&&!y&&(x.indexOf("?")<0||v)){_=!1;break}if(p[f]=decodeURIComponent(m),v||y){p[f]=P.slice(c).map(decodeURIComponent).join("/");break}}else if(w[c]!==P[c]){_=!1;break}return _===!1?!1:p}function R(l,...n){if(window.PineconeRouterMiddlewares)for(let d in window.PineconeRouterMiddlewares){let u=window.PineconeRouterMiddlewares[d];if(u[l]==null)return;if(u[l](...n)=="stop")return"stop"}}function W(l){document.dispatchEvent(new CustomEvent("fetch-error",{detail:l}))}function D(l){let n=l.reactive({version:"5.3.0",name:"pinecone-router",settings:{hash:!1,basePath:"/",templateTargetId:null,interceptLinks:!0,includeQuery:!0},notfound:new H("notfound"),routes:[],context:{route:"",path:"",params:{},query:window.location.search.substring(1),hash:window.location.hash.substring(1),navigationStack:[],navigationIndex:0,redirect(e,t=!0){return this.navigate(e,t),"stop"},navigate(e,t=!0){m(e,!1,!1,null,t)},canGoBack(){return this.navigationIndex>0},back(e=!0){m(this.navigationStack[this.navigationIndex-1],!1,!1,this.navigationIndex-1,e)},canGoForward(){return this.navigationIndex<this.navigationStack.length-1},forward(e=!0){m(this.navigationStack[this.navigationIndex+1],!1,!1,this.navigationIndex+1,e)}},add(e,t){if(this.routes.find(r=>r.path==e)!=null)throw new Error("Pinecone Router: route already exist");return t?.templates&&t?.preload&&T(null,t.templates,!0),this.routes.push(new H(e,t))-1},remove(e){this.routes=this.routes.filter(t=>t.path!=e)},loadStart:new Event("pinecone-start"),loadEnd:new Event("pinecone-end")});window.PineconeRouter=n;var d={},u={};let p=new Set,_=(e,t,r)=>{if(p.has(t))return;p.add(t);let a=e.content.cloneNode(!0).firstElementChild;a&&(l.addScopeToNode(a,{},e),l.mutateDom(()=>{r!=null?r.replaceChildren(a):e.after(a),l.initTree(a)}),e._x_PineconeRouter_CurrentTemplate=a,e._x_PineconeRouter_undoTemplate=()=>{a.remove(),delete e._x_PineconeRouter_CurrentTemplate},l.nextTick(()=>p.delete(t)))};function P(e){e._x_PineconeRouter_undoTemplate&&(e._x_PineconeRouter_undoTemplate(),delete e._x_PineconeRouter_undoTemplate)}function w(e,t,r,a){if(e._x_PineconeRouter_CurrentTemplate)return e._x_PineconeRouter_CurrentTemplate;e.content.firstElementChild?(_(e,t,a),f()):r&&(r.every(i=>u[i])?(r.length>1&&(e.innerHTML="<templates-wrapper>"),r.forEach(i=>{e.innerHTML+=u[i]}),r.length>1&&(e.innerHTML="</templates-wrapper>"),_(e,t,a),f()):T(e,r).then(()=>_(e,t,a)).finally(()=>f()))}let T=(e,t,r=!1)=>{let a=t.map(i=>d[i]?d[i]:u[i]?new Promise(o=>{o(u[i])}):(d[i]=fetch(i).then(o=>o.ok?o.text():(W(o.statusText),null)).then(o=>o==null?(u[i]=null,d[i]=null,null):(u[i]=o,d[i]=null,o)),d[i]));return Promise.all(a).then(i=>{let o=i.filter(s=>s!==null).join("");return e?(t.length>1&&!r?e.innerHTML="<templates-wrapper>"+o+"</templates-wrapper>":e.innerHTML=o,e.innerHTML):o})},c=()=>{document.dispatchEvent(n.loadStart)},f=()=>{document.dispatchEvent(n.loadEnd)},x=e=>!n.settings.hash&&n.settings.basePath!="/"?n.settings.basePath+e:e,v=e=>n.routes.findIndex(t=>t.path==e);l.directive("route",(e,{expression:t,modifiers:r},{effect:a,cleanup:i})=>{let o=t;if(R("onBeforeRouteProcessed",e,o),o.indexOf("#")>-1)throw new Error("Pinecone Router: A route's path may not have a hash character.");let s=L(r,"target",null)??window.PineconeRouter.settings.templateTargetId,h=document.getElementById(s);if(s&&!h)throw new Error("Pinecone Router: Can't find an element with the suplied target ID: "+s);let g=null;o!="notfound"&&(o=x(o),g=n.add(o));let E=n.routes[g]??n.notfound;e._x_PineconeRouter_route=o,e.content.firstElementChild!=null&&l.nextTick(()=>{a(()=>{E.handlersDone&&n.context.route==o?w(e,t,null,h):P(e)})}),i(()=>{e._x_PineconeRouter_undoTemplate&&e._x_PineconeRouter_undoTemplate(),n.remove(o),delete e._x_PineconeRouter_route}),R("onAfterRouteProcessed",e,o)}),l.directive("handler",(e,{expression:t},{evaluate:r,cleanup:a})=>{if(!e._x_PineconeRouter_route)throw new Error("Pinecone Router: x-handler must be set on the same element as x-route.");let i;!(t.startsWith("[")&&t.endsWith("]"))&&!(t.startsWith("Array(")&&t.endsWith(")"))&&(t=`[${t}]`);let o=r(t);if(typeof o=="object")i=o;else throw new Error(`Pinecone Router: Invalid handler type: ${typeof o}.`);for(let g=0;g<i.length;g++)i[g]=i[g].bind(l.$data(e));let s=e._x_PineconeRouter_route,h=s=="notfound"?n.notfound:n.routes[v(s)];h.handlers=i,a(()=>{h.handlers=[],h.handlersDone=!0,h.cancelHandlers=!1})}),l.directive("template",(e,{modifiers:t,expression:r},{Alpine:a,effect:i,evaluate:o,cleanup:s})=>{if(!e._x_PineconeRouter_route)throw new Error("Pinecone Router: x-template must be used on the same element as x-route.");if(e.content.firstElementChild!=null)throw new Error("Pinecone Router: x-template cannot be used alongside an inline template (template element should not have a child).");!(r.startsWith("[")&&r.endsWith("]"))&&!(r.startsWith("Array(")&&r.endsWith(")"))&&(r=`['${r}']`);let h=o(r),g;if(typeof h=="object")g=h;else throw new Error(`Pinecone Router: Invalid handler type: ${typeof h}.`);let E=L(t,"target",null)??window.PineconeRouter.settings.templateTargetId,b=document.getElementById(E);if(E&&!b)throw new Error("Pinecone Router: Can't find an element with the suplied target ID: "+E);t.includes("preload")&&T(e,g,!1);let M=e._x_PineconeRouter_route,I=M=="notfound"?n.notfound:n.routes[v(M)];I.templates=g,a.nextTick(()=>{i(()=>{I.handlersDone&&n.context.route==I.path?w(e,r,g,b):P(e)})}),s(()=>{e._x_PineconeRouter_undoTemplate&&e._x_PineconeRouter_undoTemplate()})}),l.$router=n.context,l.magic("router",()=>n.context),document.addEventListener("alpine:initialized",()=>{R("init"),n.settings.hash==!1?m(location.pathname,!1,!0):m(location.hash.substring(1),!1,!0)}),window.addEventListener("popstate",()=>{n.settings.hash?window.location.hash!=""&&m(window.location.hash.substring(1),!0):m(window.location.pathname,!0)}),y();function y(){function e(t){if(!t||!t.getAttribute)return;let r=t.getAttribute("href"),a=t.getAttribute("target");if(!(!r||!r.match(/^\//g)||a&&!a.match(/^_?self$/i)))return typeof r!="string"&&r.url&&(r=r.url),r}window.document.body.addEventListener("click",function(t){if(t.ctrlKey||t.metaKey||t.altKey||t.shiftKey||t.button||t.defaultPrevented)return;let r=n.routes[v(n.context.route)]??n.notfound;r.handlersDone||(r.cancelHandlers=!0,f());let a=t.target;do if(a.localName==="a"&&a.getAttribute("href")){if(window.PineconeRouter.settings.interceptLinks==!1&&!a.hasAttribute("x-link")||a.hasAttribute("data-native")||a.hasAttribute("native"))return;let i=e(a);i&&(m(i),t.stopImmediatePropagation&&t.stopImmediatePropagation(),t.stopPropagation&&t.stopPropagation(),t.preventDefault());break}while(a=a.parentNode)})}async function m(e,t=!1,r=!1,a=null,i=!0){e||(e="/"),n.settings.hash||(n.settings.basePath!="/"&&!e.startsWith(n.settings.basePath)&&(e=n.settings.basePath+e),e==n.settings.basePath&&!e.endsWith("/")&&(e+="/")),a!=null?n.context.navigationIndex=a:e!=n.context.path&&(n.context.navigationIndex!==n.context.navigationStack.length-1?(n.context.navigationStack=n.context.navigationStack.slice(0,n.context.navigationIndex+1),n.context.navigationStack.push(e),n.context.navigationIndex=n.context.navigationStack.length-1):(n.context.navigationStack.push(e),n.context.navigationIndex=n.context.navigationStack.length-1));let o=n.routes.find(s=>{let h=C(e,s.path);return s.params=h!=!1?h:{},h!=!1})??n.notfound;if(o.handlersDone=!o.handlers.length,(o.handlers.length||o.templates.length)&&c(),$(o.path,e,o.params),R("onBeforeHandlersExecuted",o,e,r)=="stop"){f();return}if(!t){let s="";if(n.settings.hash?(s="#",i&&n.settings.includeQuery&&(s+=window.location.search),s+=e):(s=e,i&&n.settings.includeQuery&&(s+=window.location.search),s+=window.location.hash),!r)history.pushState({path:s},"",s);else if(n.settings.hash&&e=="/")return m("/",!1,!1)}if(o&&o.handlers.length){if(o.cancelHandlers=!1,!await B(o.handlers,n.context)){f();return}o.handlersDone=!0,o.templates||f()}if(o.templates.length&&o.programmaticTemplates){let s=o.templateTargetId?document.getElementById(o.templateTargetId):document.getElementById(n.settings.templateTargetId);T(s,o.templates,o.programmaticTemplates).then(()=>{f()})}R("onHandlersExecuted",o,e,r)}function $(e,t,r){n.context.route=e,n.context.path=t,n.context.params=r,n.context.query=window.location.search.substring(1),n.context.hash=window.location.hash.substring(1)}function L(e,t,r){if(e.indexOf(t)===-1)return r;let a=e[e.indexOf(t)+1];if(!a)return r;if(t==="target"){let i=a.match(/([a-z0-9_-]+)/);if(i)return i[1]}return a}async function B(e,t){for(let r=0;r<e.length;r++)if(typeof e[r]=="function"){let a=n.routes[v(t.route)]??n.notfound;if(a.cancelHandlers)return a.cancelHandlers=!1,!1;let i;if(e[r].constructor.name==="AsyncFunction"?i=await e[r](t):i=e[r](t),i=="stop")return!1}return!0}}document.addEventListener("alpine:init",()=>{window.Alpine.plugin(D)});})();
//# sourceMappingURL=router.min.js.map
