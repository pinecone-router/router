(()=>{var Kj=(j)=>`Invalid expression type. Expression: ${j}`,A=(j)=>`Can't find an element with target ID: ${j}`,v=(j)=>`Route already exists: ${j}`;var Zj=(j)=>`x-${j} must be used on the same template as x-route`,x="targetID must be specified for programmatically added templates",g=(j)=>`Path: ${j} was not found`;function k(j){if(j.tagName.toLowerCase()!=="template")throw new TypeError("Directives can only be used on template elements.")}function U(j){if(k(j),j._x_PineconeRouter_route===void 0)throw new TypeError(Zj("template"))}function w(j){if(typeof j!="object"||!Array.isArray(j))throw new TypeError(Kj(j))}var c=(j,J,b)=>{if(j.indexOf(J)===-1)return b;let z=j[j.indexOf(J)+1];if(!z)return b;if(J==="target"){let Z=z.match(/([a-z0-9_-]+)/);if(Z)return Z[1]}return z},B=(j,J)=>{if(j=="notfound")return j;if(!j.startsWith(J))j=J+j;return j},y=(j)=>{return/^\[.*\]$|^Array\(.*\)$/.test(j.trim())},m=(j,J)=>{let b=j??J??"",z=document.getElementById(b);if(b&&!z)throw new ReferenceError(A(b));return z??void 0};var Q={hash:!1,basePath:"",globalHandlers:[],handleClicks:!0,targetID:void 0,preload:!1},d=(j)=>{return Q={...Q,...j},Q};var I=new Set,S=new Map,N=new Map,T=new Set,u=(j,J)=>{document.dispatchEvent(new CustomEvent("pinecone:fetch-error",{detail:{error:j,url:J}}))},h=(j,J,b,z,Z)=>{let Y=J.id+b;if(I.has(Y))return;I.add(Y);let H=J.content,G=Array(H.childElementCount);H.querySelectorAll("script").forEach(($)=>{let W=document.createElement("script");Array.from($.attributes).forEach((F)=>W.setAttribute(F.name,F.value)),W.textContent=$.textContent,$.parentNode?.replaceChild(W,$)});let K=Array.from(H.children);for(let $=0;$<K.length;$++)G[$]=K[$].cloneNode(!0),j.addScopeToNode(G[$],{},J);j.mutateDom(()=>{if(z)z.replaceChildren(...G);else J.after(...G);G.forEach(($)=>{j.initTree($)})}),J._x_PineconeRouter_template=G,J._x_PineconeRouter_templateUrls=Z,J._x_PineconeRouter_undoTemplate=()=>{j.mutateDom(()=>{G.forEach(($)=>{j.destroyTree($),$.remove()})}),delete J._x_PineconeRouter_template,delete J._x_PineconeRouter_templateUrls},j.nextTick(()=>I.delete(Y))},P=(j)=>{if(j._x_PineconeRouter_undoTemplate)j._x_PineconeRouter_undoTemplate(),delete j._x_PineconeRouter_undoTemplate},p=async(j,J,b,z,Z)=>{if(J._x_PineconeRouter_templateUrls!=null&&J._x_PineconeRouter_templateUrls!=z)P(J),J.innerHTML="";if(J._x_PineconeRouter_template)return;if(J.content.childElementCount){h(j,J,b,Z,z);return}if(z)return _(z,J).then(()=>h(j,J,b,Z,z))},O=(j,J)=>{return j.map((b)=>b.replace(/:([^/.]+)/g,(z,Z)=>J[Z]||Z))},n=async(j,J="high")=>{if(j=B(j,Q.basePath),S.has(j))return S.get(j);if(N.has(j))return N.get(j);let b=fetch(j,{priority:J}).then((z)=>{if(!z.ok)return u(z.statusText,j),"";return z.text()}).then((z)=>{if(z)S.set(j,z);return N.delete(j),z||""}).catch((z)=>{if(z instanceof TypeError)u(z.message,j);return""});return N.set(j,b),b},D=(j,J)=>{T.add({urls:j,el:J})},i=()=>{for(let j of T){if(j.el)_(j.urls,j.el,"low");else j.urls.map((J)=>n(J,"low"));T.delete(j)}},_=(j,J,b="high")=>Promise.all(j.map((z)=>n(z,b))).then((z)=>{J.innerHTML=z.join("")});var $j=(j,J)=>{j.directive("template",(b,{expression:z,modifiers:Z},{evaluate:Y,cleanup:H,Alpine:G,effect:K})=>{U(b);let $=m(c(Z,"target"),Q.targetID),W=b._x_PineconeRouter_route,F,X=Z.includes("interpolate");if(z!=""){if(!y(z))z=`['${z}']`;let M=Y(z);if(w(M),F=M,!X&&(Q.preload||Z.includes("preload")))D(F,b);let q=J.routes.get(W);q.templates=F}let L=(M)=>{if(J.context.route?.path===W){if(M&&X)M=O(M,J.context.params);p(G,b,z,M,$).then(()=>{J.loading=!1})}else P(b)},C=K(()=>L(F));H(()=>{b._x_PineconeRouter_undoTemplate&&b._x_PineconeRouter_undoTemplate(),G.release(C)})})},o=$j;var Qj=(j,J)=>{j.directive("handler",(b,{expression:z,modifiers:Z},{evaluate:Y,cleanup:H})=>{if(!y(z))z=`[${z}]`;let G=Y(z);w(G);let K=G;for(let W=0;W<K.length;W++)K[W]=K[W].bind(j.$data(b));let $;if(Z.includes("global"))Q.globalHandlers=K;else{U(b);let W=b._x_PineconeRouter_route;$=J.routes.get(W),$.handlers=K}H(()=>{if(Z.includes("global"))Q.globalHandlers=[];else $.handlers=[]})}).before("template")},s=Qj;var Yj=(j,J)=>{j.directive("route",(b,{expression:z,value:Z},{cleanup:Y})=>{let H=B(z,Q.basePath);if(k(b),H!="notfound")J.add(H,{name:Z});b._x_PineconeRouter_route=H,Y(()=>{J.routes.delete(H),delete b._x_PineconeRouter_route})}).before("handler")},l=Yj;var a=()=>{return{entries:[],index:0,canGoBack:function(){return this.index>0},back:function(){this.to(this.index-1)},canGoForward:function(){return this.index<this.entries.length-1},forward:function(){this.to(this.index+1)},to:function(j){if(j in this.entries)this.router?.navigate(this.entries[j],!1,!1,j)},push:function(j,J,b){if(this.index<this.entries.length-1)this.entries=this.entries.slice(0,this.index+1);if(this.entries.push(j),this.index=this.entries.length-1,J)this.pushState(j,b)},pushState:function(j,J){let b=J&&!j.startsWith("#")?"#"+j:j;history.pushState({path:b},"",b)},setRouter(j){this.router=j}}};var Gj=(j,{targetID:J,templates:b=[],handlers:z=[],interpolate:Z=!1,name:Y}={})=>({programmaticTemplates:b.length>0,pattern:Hj(j),interpolate:Z,templates:b,targetID:J,handlers:z,name:Y||j,path:j,match(H){let G=this.pattern.exec(H);if(G)return{...G.groups}}});function Hj(j){let b=j.split("/").filter(Boolean).map((z)=>{if(!z.startsWith(":"))return"/"+z;let[,Z,Y,H]=z.match(/^:(\w+)([?+*]?)(?:\.(.+))?$/)||[],G=Y==="*"||Y==="+",K=Y==="?"||Y==="*",W=`(?<${Z}>${G?K?".*?":".+":"[^/]+?"})`,F=H?`\\.${H}`:"",X=W+F;if(K)return`(?:/${X})?`;return`/${X}`}).join("");return new RegExp(`^${b}/?$`,"i")}var E=Gj;var f=(j,J,b)=>{return{path:j,params:J,route:b}};async function r(j,J,b){let z;return new Promise(async(Z,Y)=>{b.signal.addEventListener("abort",()=>Y());for(let H of j){if(b.signal.aborted)return;let G={...J,data:z};try{z=await H(G,b)}catch(K){Y(K)}}Z()})}var t=(j,J)=>{let b=E("notfound",{handlers:[(K)=>console.error(new ReferenceError(g(K.path)))],name:"notfound"}),z=new Map([["notfound",b]]),Z=f("",{}),Y=null,H=!1,G={name:j,version:J,history:a(),routes:z,context:Z,get loading(){return H},set loading(K){if(H==K)return;H=K,document.dispatchEvent(new Event(K?"pinecone:start":"pinecone:end"))},settings:(K)=>d(K),add:function(K,$){if(K!="notfound"){if(K=B(K,Q.basePath),this.routes.has(K))throw new Error(v(K))}if($.templates&&(Q.preload||$.preload))D($.templates);this.routes.set(K,E(K,$))},remove:function(K){this.routes.delete(K)},navigate:async function(K,$,W,F){if(Y)Y.abort();Y=new AbortController,this.loading=!0,K=B(K||"/",Q.basePath);let X=this.routes.get("notfound"),L={};for(let[q,V]of this.routes){let R=V.match(K);if(R){L=R,X=V;break}}let C=f(K,L,X),M=Q.globalHandlers.concat(X.handlers);if(M.length){try{await r(M,C,Y)}catch(q){this.loading=!1;return}if(!X.templates)this.loading=!1}if(F!=null)this.history.index=F,this.history.pushState(K,Q.hash);else if(K!=this.context.path)this.history.push(K,!$&&!W,Q.hash);if(this.context=C,X.programmaticTemplates){let q=document.getElementById(X.targetID??Q.targetID??"");if(!q)throw new Error(x);let V=X.interpolate?O(X.templates,L):X.templates;_(V,q).finally(()=>this.loading=!1)}if(!X.templates)this.loading=!1}};return G.history.setRouter(G),G};var e=(j)=>{window.document.body.addEventListener("click",(J)=>{if(J.ctrlKey||J.metaKey||J.altKey||J.shiftKey||J.button||J.defaultPrevented)return;let b=J.target.closest("a");if(!b)return;if(Q.handleClicks===!1&&!b.hasAttribute("x-link")||b.hasAttribute("data-native")||b.hasAttribute("native"))return;let z=b.getAttribute("href"),Z=b.getAttribute("target");if(z&&(!Z||/^_?self$/i.test(Z)))j.navigate(z),J.preventDefault()})};var Jj="pinecone-router",bj="7.0.0-beta.4";var Wj=function(j){let J=j.reactive(t(Jj,bj));window.PineconeRouter=J,document.addEventListener("alpine:initialized",()=>{if(Q.hash==!1)J.navigate(location.pathname+location.search,!1,!0);else J.navigate(location.hash.substring(1),!1,!0)}),window.addEventListener("popstate",()=>{if(Q.hash){if(window.location.hash!="")J.navigate(window.location.hash.substring(1),!0)}else J.navigate(window.location.pathname,!0)}),e(J),document.addEventListener("pinecone:end",()=>j.nextTick(i),{once:!0}),o(j,J),s(j,J),l(j,J),j.$router=J,j.magic("router",()=>J),j.magic("history",()=>J.history),j.magic("params",()=>J.context.params)},zj=Wj;document.addEventListener("alpine:init",()=>{window.Alpine.plugin(zj)});})();

//# debugId=BA3C899A7DF8DF9564756E2164756E21
//# sourceMappingURL=router.min.js.map
