(()=>{var k=class{params={};path;handlers=[];constructor(t,h={}){this.path=t,Object.keys(h).forEach(c=>{this[c]=h[c]}),h.templates&&(this.programmaticTemplates=!0)}templates=[];templateTargetId="";programmaticTemplates=!1;handlersDone=!1;preload=!1;cancelHandlers},C=k;function S(d){return d.replace(/(^\/+|\/+$)/g,"").split("/")}function D(d,t){let h=/(?:\?([^#]*))?(#.*)?$/,c=d.match(h),g={},E;if(c&&c[1]){let m=c[1].split("&");for(let f=0;f<m.length;f++){let x=m[f].split("=");g[decodeURIComponent(x[0])]=decodeURIComponent(x.slice(1).join("="))}}let _=S(d.replace(h,"")),p=S(t||""),b=Math.max(_.length,p.length);for(let m=0;m<b;m++)if(p[m]&&p[m].charAt(0)===":"){let f=p[m].replace(/(^:|[+*?]+$)/g,""),x=(p[m].match(/[+*?]+$/)||{}).toString()[0],R=~x.indexOf("+"),P=~x.indexOf("*"),y=_[m]||"";if(!y&&!P&&(x.indexOf("?")<0||R)){E=!1;break}if(g[f]=decodeURIComponent(y),R||P){g[f]=_.slice(m).map(decodeURIComponent).join("/");break}}else if(p[m]!==_[m]){E=!1;break}return E===!1?!1:g}function T(d,...t){if(window.PineconeRouterMiddlewares)for(let h in window.PineconeRouterMiddlewares){let c=window.PineconeRouterMiddlewares[h];if(c[d]==null)return;if(c[d](...t)=="stop")return"stop"}}function A(d){let t=d.reactive({version:"6.1.0",name:"pinecone-router",settings:{hash:!1,basePath:"/",templateTargetId:null,interceptLinks:!0,alwaysSendLoadingEvents:!1},notfound:new C("notfound"),routes:[],globalHandlers:[],context:{route:"",path:"",params:{},query:window.location.search.substring(1),hash:window.location.hash.substring(1),navigationStack:[],navigationIndex:0,redirect(e){return this.navigate(e),"stop"},navigate(e){w(e,!1,!1,null)},canGoBack(){return this.navigationIndex>0},back(){w(this.navigationStack[this.navigationIndex-1],!1,!1,this.navigationIndex-1)},canGoForward(){return this.navigationIndex<this.navigationStack.length-1},forward(){w(this.navigationStack[this.navigationIndex+1],!1,!1,this.navigationIndex+1)}},endEventDispatched:!1,startEventDispatched:!1,add(e,n){if(this.routes.find(r=>r.path==e)!=null)throw new Error("Pinecone Router: route already exist");return n?.templates&&n?.preload&&b(null,n.templates,!0),this.routes.push(new C(e,n))-1},remove(e){this.routes=this.routes.filter(n=>n.path!=e)},loadStart:new Event("pinecone-start"),loadEnd:new Event("pinecone-end")});window.PineconeRouter=t;var h={},c={};let g=new Set,E=(e,n,r)=>{if(g.has(n))return;g.add(n);let i=e.content.firstElementChild,a=e.content.children[1];if(!i)return;d.addScopeToNode(i,{},e);let o=null;d.mutateDom(()=>{let u=i.cloneNode(!0);if(r!=null?r.replaceChildren(u):e.after(u),u.querySelectorAll("script").forEach(s=>{let l=document.createElement("script");Array.from(s.attributes).forEach(v=>l.setAttribute(v.name,v.value)),l.textContent=s.textContent,s.parentNode.replaceChild(l,s)}),a?.tagName?.toLowerCase()==="script"){let s=document.createElement("script");Array.from(a.attributes).forEach(l=>s.setAttribute(l.name,l.value)),s.textContent=a.textContent,document.body.appendChild(s),o=s}d.initTree(u),e._x_PineconeRouter_CurrentTemplate=u}),e._x_PineconeRouter_undoTemplate=()=>{e._x_PineconeRouter_CurrentTemplate?.remove(),o?.parentNode?.removeChild(o),delete e._x_PineconeRouter_CurrentTemplate},d.nextTick(()=>g.delete(n))},_=e=>{e._x_PineconeRouter_undoTemplate&&(e._x_PineconeRouter_undoTemplate(),delete e._x_PineconeRouter_undoTemplate)},p=(e,n,r,i,a=!1)=>{if(e._x_PineconeRouter_CurrentTemplate)return e._x_PineconeRouter_CurrentTemplate;e.content.firstElementChild?(E(e,n,i),a||f()):r&&(r.every(o=>c[o])?(r.length>1&&(e.innerHTML="<templates-wrapper>"),r.forEach(o=>{e.innerHTML+=c[o]}),r.length>1&&(e.innerHTML="</templates-wrapper>"),E(e,n,i),f()):b(e,r).then(()=>E(e,n,i)).finally(()=>f()))},b=(e,n,r=!1)=>{let i=n.map(a=>h[a]?h[a]:c[a]?new Promise(o=>{o(c[a])}):(h[a]=fetch(a).then(o=>o.ok?o.text():(x(o.statusText),null)).then(o=>o==null?(c[a]=null,h[a]=null,null):(c[a]=o,h[a]=null,o)),h[a]));return Promise.all(i).then(a=>{let o=a.filter(u=>u!==null).join("");return e?(n.length>1&&!r?e.innerHTML="<templates-wrapper>"+o+"</templates-wrapper>":e.innerHTML=o,e.innerHTML):o})},m=()=>{t.startEventDispatched||document.dispatchEvent(t.loadStart),t.startEventDispatched=!0},f=()=>{t.endEventDispatched||document.dispatchEvent(t.loadEnd),t.endEventDispatched=!0};function x(e){document.dispatchEvent(new CustomEvent("fetch-error",{detail:e}))}let R=e=>!t.settings.hash&&t.settings.basePath!="/"?t.settings.basePath+e:e,P=e=>t.routes.findIndex(n=>n.path==e);d.directive("template",(e,{modifiers:n,expression:r},{Alpine:i,effect:a,evaluate:o,cleanup:u})=>{if(!e._x_PineconeRouter_route)throw new Error("Pinecone Router: x-template must be used on the same element as x-route.");if(e.content.firstElementChild!=null)throw new Error("Pinecone Router: x-template cannot be used alongside an inline template (template element should not have a child).");!(r.startsWith("[")&&r.endsWith("]"))&&!(r.startsWith("Array(")&&r.endsWith(")"))&&(r=`['${r}']`);let s=o(r),l;if(typeof s=="object")l=s;else throw new Error(`Pinecone Router: Invalid template type: ${typeof s}.`);let v=L(n,"target",null)??window.PineconeRouter.settings.templateTargetId,H=document.getElementById(v);if(v&&!H)throw new Error("Pinecone Router: Can't find an element with the suplied target ID: "+v);n.includes("preload")&&b(e,l,!1);let M=e._x_PineconeRouter_route,I=M=="notfound"?t.notfound:t.routes[P(M)];I.templates=l,i.nextTick(()=>{a(()=>{I.handlersDone&&t.context.route==I.path?p(e,r,l,H):_(e)})}),u(()=>{e._x_PineconeRouter_undoTemplate&&e._x_PineconeRouter_undoTemplate()})}),d.directive("handler",(e,{expression:n,modifiers:r},{evaluate:i,cleanup:a})=>{if(!r.includes("global")&&!e._x_PineconeRouter_route)throw new Error("Pinecone Router: x-handler must be set on the same element as x-route, or on the router element with the modifier .global.");let o;!(n.startsWith("[")&&n.endsWith("]"))&&!(n.startsWith("Array(")&&n.endsWith(")"))&&(n=`[${n}]`);let u=i(n);if(typeof u=="object")o=u;else throw new Error(`Pinecone Router: Invalid handler type: ${typeof u}.`);for(let l=0;l<o.length;l++)o[l]=o[l].bind(d.$data(e));let s;if(r.includes("global"))t.globalHandlers=o;else{let l=e._x_PineconeRouter_route;s=l=="notfound"?t.notfound:t.routes[P(l)],s.handlers=o}a(()=>{r.includes("global")?t.globalHandlers=[]:(s.handlers=[],s.handlersDone=!0,s.cancelHandlers=!1)})}).before("template"),d.directive("route",(e,{expression:n,modifiers:r},{effect:i,cleanup:a})=>{let o=n;if(T("onBeforeRouteProcessed",e,o),o.indexOf("#")>-1)throw new Error("Pinecone Router: A route's path may not have a hash character.");let u=L(r,"target",null)??window.PineconeRouter.settings.templateTargetId,s=document.getElementById(u);if(u&&!s)throw new Error("Pinecone Router: Can't find an element with the suplied target ID: "+u);let l=null;o!="notfound"&&(o=R(o),l=t.add(o));let v=t.routes[l]??t.notfound;e._x_PineconeRouter_route=o,e.content.firstElementChild!=null&&d.nextTick(()=>{i(()=>{v.handlersDone&&t.context.route==o?p(e,n,null,s,!0):_(e)})}),a(()=>{e._x_PineconeRouter_undoTemplate&&e._x_PineconeRouter_undoTemplate(),t.remove(o),delete e._x_PineconeRouter_route}),T("onAfterRouteProcessed",e,o)}).before("handler"),d.$router=t.context,d.magic("router",()=>t.context),document.addEventListener("alpine:initialized",()=>{T("init"),t.settings.hash==!1?w(location.pathname+location.search,!1,!0):w(location.hash.substring(1),!1,!0)}),window.addEventListener("popstate",()=>{t.settings.hash?window.location.hash!=""&&w(window.location.hash.substring(1),!0):w(window.location.pathname,!0)}),y();function y(){function e(n){if(!n||!n.getAttribute)return;let r=n.getAttribute("href"),i=n.getAttribute("target");if(!(!r||!r.match(/^\//g)||i&&!i.match(/^_?self$/i)))return typeof r!="string"&&r.url&&(r=r.url),r}window.document.body.addEventListener("click",function(n){if(n.ctrlKey||n.metaKey||n.altKey||n.shiftKey||n.button||n.defaultPrevented)return;let r=t.routes[P(t.context.route)]??t.notfound;r.handlersDone||(r.cancelHandlers=!0,f());let i=n.target;do if(i.localName==="a"&&i.getAttribute("href")){if(window.PineconeRouter.settings.interceptLinks==!1&&!i.hasAttribute("x-link")||i.hasAttribute("data-native")||i.hasAttribute("native"))return;let a=e(i);a&&(w(a),n.stopImmediatePropagation&&n.stopImmediatePropagation(),n.stopPropagation&&n.stopPropagation(),n.preventDefault());break}while(i=i.parentNode)})}async function w(e,n=!1,r=!1,i=null){t.startEventDispatched=!1,t.endEventDispatched=!1,e||(e="/"),t.settings.hash||(t.settings.basePath!="/"&&!e.startsWith(t.settings.basePath)&&(e=t.settings.basePath+e),e==t.settings.basePath&&!e.endsWith("/")&&(e+="/")),i!=null?t.context.navigationIndex=i:e!=t.context.path&&(t.context.navigationIndex!==t.context.navigationStack.length-1?(t.context.navigationStack=t.context.navigationStack.slice(0,t.context.navigationIndex+1),t.context.navigationStack.push(e),t.context.navigationIndex=t.context.navigationStack.length-1):(t.context.navigationStack.push(e),t.context.navigationIndex=t.context.navigationStack.length-1));let a=t.routes.find(o=>{let u=D(e,o.path);return o.params=u!=!1?u:{},u!=!1})??t.notfound;if(a.handlersDone=!a.handlers.length&&!t.globalHandlers.length,(t.settings.alwaysSendLoadingEvents||(a.handlers.length||t.globalHandlers.length||a.templates.length)&&t.context.path!=e)&&m(),$(a.path,e,a.params),T("onBeforeHandlersExecuted",a,e,r)=="stop"){f();return}if(!n){let o="";if(t.settings.hash?(o="#",o+=e):(o=e,o+=window.location.hash),!r)history.pushState({path:o},"",o);else if(t.settings.hash&&e=="/")return w("/",!1,!1)}if(a&&(a.handlers.length||t.globalHandlers.length)){if(a.cancelHandlers=!1,!await W(t.globalHandlers.concat(a.handlers),t.context)){f();return}a.handlersDone=!0,a.templates||f()}if(a.templates.length&&a.programmaticTemplates){let o=a.templateTargetId?document.getElementById(a.templateTargetId):document.getElementById(t.settings.templateTargetId);b(o,a.templates,a.programmaticTemplates).then(()=>{f()})}t.settings.alwaysSendLoadingEvents&&!t.endEventDispatched&&f(),T("onHandlersExecuted",a,e,r)}function $(e,n,r){t.context.route=e,t.context.path=n,t.context.params=r,t.context.query=window.location.search.substring(1),t.context.hash=window.location.hash.substring(1)}function L(e,n,r){if(e.indexOf(n)===-1)return r;let i=e[e.indexOf(n)+1];if(!i)return r;if(n==="target"){let a=i.match(/([a-z0-9_-]+)/);if(a)return a[1]}return i}async function W(e,n){for(let r=0;r<e.length;r++)if(typeof e[r]=="function"){let i=t.routes[P(n.route)]??t.notfound;if(i.cancelHandlers)return i.cancelHandlers=!1,!1;let a;if(e[r].constructor.name==="AsyncFunction"?a=await e[r](n):a=e[r](n),a=="stop")return!1}return!0}}document.addEventListener("alpine:init",()=>{window.Alpine.plugin(A)});})();
//# sourceMappingURL=router.min.js.map
