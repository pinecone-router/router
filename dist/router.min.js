(()=>{var I=class{params={};path;handlers=[];constructor(t,g={}){this.path=t,Object.keys(g).forEach(f=>{this[f]=g[f]}),g.templates&&(this.programmaticTemplates=!0)}templates=[];templateTargetId="";programmaticTemplates=!1;handlersDone=!1;preload=!1;cancelHandlers},k=I;function M(c){return c.replace(/(^\/+|\/+$)/g,"").split("/")}function D(c,t){let g=/(?:\?([^#]*))?(#.*)?$/,f=c.match(g),m={},P;if(f&&f[1]){let d=f[1].split("&");for(let x=0;x<d.length;x++){let h=d[x].split("=");m[decodeURIComponent(h[0])]=decodeURIComponent(h.slice(1).join("="))}}let w=M(c.replace(g,"")),p=M(t||""),R=Math.max(w.length,p.length);for(let d=0;d<R;d++)if(p[d]&&p[d].charAt(0)===":"){let x=p[d].replace(/(^:|[+*?]+$)/g,""),h=(p[d].match(/[+*?]+$/)||{}).toString()[0],b=~h.indexOf("+"),y=~h.indexOf("*"),E=w[d]||"";if(!E&&!y&&(h.indexOf("?")<0||b)){P=!1;break}if(m[x]=decodeURIComponent(E),b||y){m[x]=w.slice(d).map(decodeURIComponent).join("/");break}}else if(p[d]!==w[d]){P=!1;break}return P===!1?!1:m}function T(c,...t){if(window.PineconeRouterMiddlewares)for(let g in window.PineconeRouterMiddlewares){let f=window.PineconeRouterMiddlewares[g];if(f[c]==null)return;if(f[c](...t)=="stop")return"stop"}}function A(c){let t=c.reactive({version:"6.2.5",name:"pinecone-router",settings:{hash:!1,basePath:"/",templateTargetId:null,interceptLinks:!0,alwaysSendLoadingEvents:!1},notfound:new k("notfound"),routes:[],globalHandlers:[],context:{route:"",path:"",params:{},query:window.location.search.substring(1),hash:window.location.hash.substring(1),navigationStack:[],navigationIndex:0,redirect(e){return this.navigate(e),"stop"},navigate(e){_(e,!1,!1,null)},canGoBack(){return this.navigationIndex>0},back(){_(this.navigationStack[this.navigationIndex-1],!1,!1,this.navigationIndex-1)},canGoForward(){return this.navigationIndex<this.navigationStack.length-1},forward(){_(this.navigationStack[this.navigationIndex+1],!1,!1,this.navigationIndex+1)}},endEventDispatched:!1,startEventDispatched:!1,add(e,n){if(this.routes.find(r=>r.path==e)!=null)throw new Error("Pinecone Router: route already exist");return n?.templates&&n?.preload&&d(null,n.templates,!0),this.routes.push(new k(e,n))-1},remove(e){this.routes=this.routes.filter(n=>n.path!=e)},loadStart:new Event("pinecone-start"),loadEnd:new Event("pinecone-end")}),g=t.settings.hash?location.hash.substring(1):location.pathname;t.context.path=g,window.PineconeRouter=t;var f={},m={};let P=new Set,w=(e,n,r,i)=>{if(P.has(n))return;P.add(n);let o=e.content.firstElementChild,a=e.content.children[1];if(!o)return;let l=o.cloneNode(!0);c.addScopeToNode(o,{},e),c.mutateDom(()=>{if(i!=null?i.replaceChildren(l):e.after(l),l.querySelectorAll("script").forEach(s=>{let u=document.createElement("script");Array.from(s.attributes).forEach(v=>u.setAttribute(v.name,v.value)),u.textContent=s.textContent,s.parentNode.replaceChild(u,s)}),a?.tagName?.toLowerCase()==="script"){let s=document.createElement("script");Array.from(a.attributes).forEach(u=>s.setAttribute(u.name,u.value)),s.textContent=a.textContent,document.body.appendChild(s),e._x_PineconeRouter_CurrentTemplateScript=s}c.initTree(l)}),e._x_PineconeRouter_CurrentTemplate=l,e._x_PineconeRouter_CurrentTemplateUrls=r,e._x_PineconeRouter_undoTemplate=()=>{e._x_PineconeRouter_CurrentTemplate?.remove(),e._x_PineconeRouter_CurrentTemplateScript?.parentNode?.removeChild(e._x_PineconeRouter_CurrentTemplateScript),delete e._x_PineconeRouter_CurrentTemplate},c.nextTick(()=>P.delete(n))},p=e=>{e._x_PineconeRouter_undoTemplate&&(e._x_PineconeRouter_undoTemplate(),delete e._x_PineconeRouter_undoTemplate)},R=(e,n,r,i,o)=>{if(o&&(r=r.map(a=>(a=a.replace(/:([^/.]+)/g,(l,s)=>t.context.params[s]||l),a))),e._x_PineconeRouter_CurrentTemplateUrls!=null&&e._x_PineconeRouter_CurrentTemplateUrls!=r&&(p(e),e.content.firstElementChild?.remove()),e._x_PineconeRouter_CurrentTemplate)return e._x_PineconeRouter_CurrentTemplate;e.content.firstElementChild?(w(e,n,r,i),t.startEventDispatched&&h()):r&&(r.every(a=>m[a])?(r.length>1&&(e.innerHTML="<templates-wrapper>"),r.forEach(a=>{e.innerHTML+=m[a]}),r.length>1&&(e.innerHTML="</templates-wrapper>"),w(e,n,r,i),h()):d(e,r).then(()=>w(e,n,r,i)).finally(()=>h()))},d=(e,n,r=!1)=>{let i=n.map(o=>f[o]?f[o]:m[o]?new Promise(a=>{a(m[o])}):(f[o]=fetch(o).then(a=>a.ok?a.text():(b(a.statusText),null)).then(a=>a==null?(m[o]=null,f[o]=null,null):(m[o]=a,f[o]=null,a)),f[o]));return Promise.all(i).then(o=>{let a=o.filter(l=>l!==null).join("");return e?(n.length>1&&!r?e.innerHTML="<templates-wrapper>"+a+"</templates-wrapper>":e.innerHTML=a,e.innerHTML):a})},x=()=>{t.startEventDispatched||document.dispatchEvent(t.loadStart),t.startEventDispatched=!0},h=()=>{t.endEventDispatched||document.dispatchEvent(t.loadEnd),t.endEventDispatched=!0};function b(e){document.dispatchEvent(new CustomEvent("fetch-error",{detail:e}))}let y=e=>!t.settings.hash&&t.settings.basePath!="/"?t.settings.basePath+e:e,E=e=>t.routes.findIndex(n=>n.path==e);c.directive("template",(e,{modifiers:n,expression:r},{Alpine:i,effect:o,evaluate:a,cleanup:l})=>{if(!e._x_PineconeRouter_route)throw new Error("Pinecone Router: x-template must be used on the same element as x-route.");if(e.content.firstElementChild!=null)throw new Error("Pinecone Router: x-template cannot be used alongside an inline template (template element should not have a child).");!(r.startsWith("[")&&r.endsWith("]"))&&!(r.startsWith("Array(")&&r.endsWith(")"))&&(r=`['${r}']`);let s=a(r),u;if(typeof s=="object")u=s;else throw new Error(`Pinecone Router: Invalid template type: ${typeof s}.`);let v=L(n,"target",null)??window.PineconeRouter.settings.templateTargetId,C=document.getElementById(v);if(v&&!C)throw new Error("Pinecone Router: Can't find an element with the suplied target ID: "+v);if(n.includes("preload")){if(n.includes("interpolate"))throw new Error("Pinecone Router: Can't use the 'interpolate' modifier with the 'preload' modifier.");d(e,u,!1)}let S=e._x_PineconeRouter_route,H=S=="notfound"?t.notfound:t.routes[E(S)];H.templates=u,i.nextTick(()=>{o(()=>{H.handlersDone&&t.context.route==H.path?R(e,r,u,C,n.includes("interpolate")):p(e)})}),l(()=>{e._x_PineconeRouter_undoTemplate&&e._x_PineconeRouter_undoTemplate()})}),c.directive("handler",(e,{expression:n,modifiers:r},{evaluate:i,cleanup:o})=>{if(!r.includes("global")&&!e._x_PineconeRouter_route)throw new Error("Pinecone Router: x-handler must be set on the same element as x-route, or on the router element with the modifier .global.");let a;!(n.startsWith("[")&&n.endsWith("]"))&&!(n.startsWith("Array(")&&n.endsWith(")"))&&(n=`[${n}]`);let l=i(n);if(typeof l=="object")a=l;else throw new Error(`Pinecone Router: Invalid handler type: ${typeof l}.`);for(let u=0;u<a.length;u++)a[u]=a[u].bind(c.$data(e));let s;if(r.includes("global"))t.globalHandlers=a;else{let u=e._x_PineconeRouter_route;s=u=="notfound"?t.notfound:t.routes[E(u)],s.handlers=a}o(()=>{r.includes("global")?t.globalHandlers=[]:(s.handlers=[],s.handlersDone=!0,s.cancelHandlers=!1)})}).before("template"),c.directive("route",(e,{expression:n,modifiers:r},{effect:i,cleanup:o})=>{let a=n;if(T("onBeforeRouteProcessed",e,a),a.indexOf("#")>-1)throw new Error("Pinecone Router: A route's path may not have a hash character.");let l=L(r,"target",null)??window.PineconeRouter.settings.templateTargetId,s=document.getElementById(l);if(l&&!s)throw new Error("Pinecone Router: Can't find an element with the suplied target ID: "+l);let u=null;a!="notfound"&&(a=y(a),u=t.add(a));let v=t.routes[u]??t.notfound;e._x_PineconeRouter_route=a,e.content.firstElementChild!=null&&c.nextTick(()=>{i(()=>{v.handlersDone&&t.context.route==a?R(e,n,null,s):p(e)})}),o(()=>{e._x_PineconeRouter_undoTemplate&&e._x_PineconeRouter_undoTemplate(),t.remove(a),delete e._x_PineconeRouter_route}),T("onAfterRouteProcessed",e,a)}).before("handler"),c.$router=t.context,c.magic("router",()=>t.context),document.addEventListener("alpine:initialized",()=>{T("init"),_(g,!1,!0)}),window.addEventListener("popstate",()=>{t.settings.hash?window.location.hash!=""&&_(window.location.hash.substring(1),!0):_(window.location.pathname,!0)}),$();function $(){function e(n){if(!n||!n.getAttribute)return;let r=n.getAttribute("href"),i=n.getAttribute("target");if(!(!r||!r.match(/^\//g)||i&&!i.match(/^_?self$/i)))return typeof r!="string"&&r.url&&(r=r.url),r}window.document.body.addEventListener("click",function(n){if(n.ctrlKey||n.metaKey||n.altKey||n.shiftKey||n.button||n.defaultPrevented)return;let r=t.routes[E(t.context.route)]??t.notfound;r.handlersDone||(r.cancelHandlers=!0,h());let i=n.target;do if(i.localName==="a"&&i.getAttribute("href")){if(window.PineconeRouter.settings.interceptLinks==!1&&!i.hasAttribute("x-link")||i.hasAttribute("data-native")||i.hasAttribute("native"))return;let o=e(i);o&&(_(o),n.stopImmediatePropagation&&n.stopImmediatePropagation(),n.stopPropagation&&n.stopPropagation(),n.preventDefault());break}while(i=i.parentNode)})}async function _(e,n=!1,r=!1,i=null){t.startEventDispatched=!1,t.endEventDispatched=!1,e||(e="/"),t.settings.hash||(t.settings.basePath!="/"&&!e.startsWith(t.settings.basePath)&&(e=t.settings.basePath+e),e==t.settings.basePath&&!e.endsWith("/")&&(e+="/")),i!=null?t.context.navigationIndex=i:e!=t.context.path&&(t.context.navigationIndex!==t.context.navigationStack.length-1?(t.context.navigationStack=t.context.navigationStack.slice(0,t.context.navigationIndex+1),t.context.navigationStack.push(e),t.context.navigationIndex=t.context.navigationStack.length-1):(t.context.navigationStack.push(e),t.context.navigationIndex=t.context.navigationStack.length-1));let o=t.routes.find(a=>{let l=D(e,a.path);return a.params=l!=!1?l:{},l!=!1})??t.notfound;if(o.handlersDone=!o.handlers.length&&!t.globalHandlers.length,(t.settings.alwaysSendLoadingEvents||(o.handlers.length||t.globalHandlers.length||o.templates.length)&&t.context.path!=e)&&x(),W(o.path,e,o.params),T("onBeforeHandlersExecuted",o,e,r)=="stop"){h();return}if(!n){let a="";if(t.settings.hash?(a="#",a+=e):(a=e,a+=window.location.hash),!r)history.pushState({path:a},"",a);else if(t.settings.hash&&e=="/")return _("/",!1,!1)}if(o&&(o.handlers.length||t.globalHandlers.length)){if(o.cancelHandlers=!1,!await N(t.globalHandlers.concat(o.handlers),t.context)){h();return}o.handlersDone=!0,o.templates||h()}if(o.templates.length&&o.programmaticTemplates){let a=o.templateTargetId?document.getElementById(o.templateTargetId):document.getElementById(t.settings.templateTargetId);d(a,o.templates,o.programmaticTemplates).then(()=>{h()})}t.settings.alwaysSendLoadingEvents&&!t.endEventDispatched&&h(),T("onHandlersExecuted",o,e,r)}function W(e,n,r){t.context.route=e,t.context.path=n,t.context.params=r,t.context.query=window.location.search.substring(1),t.context.hash=window.location.hash.substring(1)}function L(e,n,r){if(e.indexOf(n)===-1)return r;let i=e[e.indexOf(n)+1];if(!i)return r;if(n==="target"){let o=i.match(/([a-z0-9_-]+)/);if(o)return o[1]}return i}async function N(e,n){for(let r=0;r<e.length;r++)if(typeof e[r]=="function"){let i=t.routes[E(n.route)]??t.notfound;if(i.cancelHandlers)return i.cancelHandlers=!1,!1;let o;if(e[r].constructor.name==="AsyncFunction"?o=await e[r](n):o=e[r](n),o=="stop")return!1}return!0}}document.addEventListener("alpine:init",()=>{window.Alpine.plugin(A)});})();
//# sourceMappingURL=router.min.js.map
