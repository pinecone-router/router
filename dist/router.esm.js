var R=()=>{return{entries:[],index:0,canGoBack:function(){return this.index>0},back:function(){this.to(this.index-1)},canGoForward:function(){return this.index<this.entries.length-1},forward:function(){this.to(this.index+1)},to:function(j){if(j in this.entries)this.router?.navigate(this.entries[j],!1,!1,j)},push:function(j,y,J){if(this.index<this.entries.length-1)this.entries=this.entries.slice(0,this.index+1);if(this.entries.push(j),this.index=this.entries.length-1,y)this.pushState(j,J)},pushState:function(j,y){let J=y&&!j.startsWith("#")?"#"+j:j;history.pushState({path:J},"",J)},setRouter(j){this.router=j}}};var bj=(j,{targetID:y,templates:J=[],handlers:b=[],interpolate:K=!1}={})=>({programmaticTemplates:J.length>0,pattern:zj(j),interpolate:K,templates:J,targetID:y,handlers:b,path:j,match($){let G=this.pattern.exec($);if(G)return{...G.groups}}});function zj(j){let J=j.split("/").filter(Boolean).map((b)=>{if(!b.startsWith(":"))return"/"+b;let[,K,$,G]=b.match(/^:(\w+)([?+*]?)(?:\.(.+))?$/)||[],Y=$==="*"||$==="+",z=$==="?"||$==="*",H=`(?<${K}>${Y?z?".*?":".+":"[^/]+?"})`,X=G?`\\.${G}`:"",W=H+X;if(z)return`(?:/${W})?`;return`/${W}`}).join("");return new RegExp(`^${J}/?$`,"i")}var k=bj;var Q={hash:!1,basePath:"",globalHandlers:[],handleClicks:!0,targetID:void 0,preload:!1},x=(j)=>{return Q={...Q,...j},Q};var Kj=(j)=>`Invalid expression type. Expression: ${j}`,A=(j)=>`Can't find an element with target ID: ${j}`,d=(j)=>`Route already exists: ${j}`;var Zj=(j)=>`x-${j} must be used on the same template as x-route`,g="targetID must be specified for programmatically added templates",c=(j)=>`Path: ${j} was not found`;function I(j){if(j.tagName.toLowerCase()!=="template")throw new TypeError("Directives can only be used on template elements.")}function V(j){if(I(j),j._x_PineconeRouter_route===void 0)throw new TypeError(Zj("template"))}function U(j){if(typeof j!="object"||!Array.isArray(j))throw new TypeError(Kj(j))}var m=(j,y,J)=>{if(j.indexOf(y)===-1)return J;let b=j[j.indexOf(y)+1];if(!b)return J;if(y==="target"){let K=b.match(/([a-z0-9_-]+)/);if(K)return K[1]}return b},q=(j,y)=>{if(j=="notfound")return j;if(!j.startsWith(y))j=y+j;return j},O=(j)=>{return/^\[.*\]$|^Array\(.*\)$/.test(j.trim())},u=(j,y)=>{let J=j??y??"",b=document.getElementById(J);if(J&&!b)throw new ReferenceError(A(J));return b??void 0};var S=new Set,T=new Map,N=new Map,P=new Set,$j=(j,y)=>{document.dispatchEvent(new CustomEvent("pinecone:fetch-error",{detail:{error:j,url:y}}))},h=(j,y,J,b,K)=>{let $=y.id+J;if(S.has($))return;S.add($);let G=y.content,Y=Array(G.childElementCount);G.querySelectorAll("script").forEach((Z)=>{let H=document.createElement("script");Array.from(Z.attributes).forEach((X)=>H.setAttribute(X.name,X.value)),H.textContent=Z.textContent,Z.parentNode?.replaceChild(H,Z)});let z=Array.from(G.children);for(let Z=0;Z<z.length;Z++)Y[Z]=z[Z].cloneNode(!0),j.addScopeToNode(Y[Z],{},y);j.mutateDom(()=>{if(b)b.replaceChildren(...Y);else y.after(...Y);Y.forEach((Z)=>{j.initTree(Z)})}),y._x_PineconeRouter_template=Y,y._x_PineconeRouter_templateUrls=K,y._x_PineconeRouter_undoTemplate=()=>{j.mutateDom(()=>{Y.forEach((Z)=>{j.destroyTree(Z),Z.remove()})}),delete y._x_PineconeRouter_template,delete y._x_PineconeRouter_templateUrls},j.nextTick(()=>S.delete($))},E=(j)=>{if(j._x_PineconeRouter_undoTemplate)j._x_PineconeRouter_undoTemplate(),delete j._x_PineconeRouter_undoTemplate},i=async(j,y,J,b,K)=>{if(y._x_PineconeRouter_templateUrls!=null&&y._x_PineconeRouter_templateUrls!=b)E(y),y.innerHTML="";if(y._x_PineconeRouter_template)return;if(y.content.childElementCount){h(j,y,J,K,b);return}if(b)return _(b,y).then(()=>h(j,y,J,K,b))},w=(j,y)=>{return j.map((J)=>J.replace(/:([^/.]+)/g,(b,K)=>y[K]||K))},p=async(j,y="high")=>{if(j=q(j,Q.basePath),T.has(j))return T.get(j);if(N.has(j))return N.get(j);let J=fetch(j,{priority:y}).then((b)=>{if(!b.ok)return $j(b.statusText,j),"";return b.text()}).then((b)=>{if(b)T.set(j,b);return N.delete(j),b||""});return N.set(j,J),J},D=(j,y)=>{P.add({urls:j,el:y})},s=()=>{for(let j of P){if(j.el)_(j.urls,j.el,"low");else j.urls.map((y)=>p(y,"low"));P.delete(j)}},_=(j,y,J="high")=>Promise.all(j.map((b)=>p(b,J))).then((b)=>{y.innerHTML=b.join("")});var f=(j,y,J)=>{return{path:j,route:J,params:y}};async function n(j,y,J){let b;return new Promise(async(K,$)=>{J.signal.addEventListener("abort",()=>$());for(let G of j){if(J.signal.aborted)return;let Y={...y,data:b};try{b=await G(Y,J)}catch(z){$(z)}}K()})}var o=(j,y)=>{let J=k("notfound",{handlers:[(z)=>console.error(new ReferenceError(c(z.path)))]}),b=new Map([["notfound",J]]),K=f("",{},""),$=null,G=!1,Y={name:j,version:y,history:R(),routes:b,context:K,get loading(){return G},set loading(z){if(G==z)return;G=z,document.dispatchEvent(new Event(z?"pinecone:start":"pinecone:end"))},settings:(z)=>x(z),add:function(z,Z){if(z!="notfound"){if(z=q(z,Q.basePath),this.routes.has(z))throw new Error(d(z))}if(Z.templates&&(Q.preload||Z.preload))D(Z.templates);this.routes.set(z,k(z,Z))},remove:function(z){this.routes.delete(z)},navigate:async function(z,Z,H,X){if($)$.abort();$=new AbortController,this.loading=!0,z=q(z||"/",Q.basePath);let W=this.routes.get("notfound"),B={};for(let[M,L]of this.routes){let v=L.match(z);if(v){B=v,W=L;break}}let C=f(z,B,W.path),F=Q.globalHandlers.concat(W.handlers);if(F.length){try{await n(F,C,$)}catch(M){this.loading=!1;return}if(!W.templates)this.loading=!1}if(X!=null)this.history.index=X,this.history.pushState(z,Q.hash);else if(z!=this.context.path)this.history.push(z,!Z&&!H,Q.hash);if(this.context=C,W.programmaticTemplates){let M=document.getElementById(W.targetID??Q.targetID??"");if(!M)throw new Error(g);let L=W.interpolate?w(W.templates,B):W.templates;_(L,M).finally(()=>this.loading=!1)}if(!W.templates)this.loading=!1}};return Y.history.setRouter(Y),Y};var Qj=(j,y)=>{j.directive("template",(J,{expression:b,modifiers:K},{evaluate:$,cleanup:G,Alpine:Y,effect:z})=>{V(J);let Z=u(m(K,"target"),Q.targetID),H=J._x_PineconeRouter_route,X,W=K.includes("interpolate");if(b!=""){if(!O(b))b=`['${b}']`;let F=$(b);if(U(F),X=F,!W&&(Q.preload||K.includes("preload")))D(X,J);let M=y.routes.get(H);M.templates=X}let B=(F)=>{if(y.context.route===H){if(F&&W)F=w(F,y.context.params);i(Y,J,b,F,Z).then(()=>{y.loading=!1})}else E(J)},C=z(()=>B(X));G(()=>{J._x_PineconeRouter_undoTemplate&&J._x_PineconeRouter_undoTemplate(),Y.release(C)})})},l=Qj;var Yj=(j,y)=>{j.directive("handler",(J,{expression:b,modifiers:K},{evaluate:$,cleanup:G})=>{if(!O(b))b=`[${b}]`;let Y=$(b);U(Y);let z=Y;for(let H=0;H<z.length;H++)z[H]=z[H].bind(j.$data(J));let Z;if(K.includes("global"))Q.globalHandlers=z;else{V(J);let H=J._x_PineconeRouter_route;Z=y.routes.get(H),Z.handlers=z}G(()=>{if(K.includes("global"))Q.globalHandlers=[];else Z.handlers=[]})}).before("template")},r=Yj;var Gj=(j,y)=>{j.directive("route",(J,{expression:b},{cleanup:K})=>{let $=q(b,Q.basePath);if(I(J),$!="notfound")y.add($,{});J._x_PineconeRouter_route=$,K(()=>{y.routes.delete($),delete J._x_PineconeRouter_route})}).before("handler")},a=Gj;var t=(j)=>{window.document.body.addEventListener("click",(y)=>{if(y.ctrlKey||y.metaKey||y.altKey||y.shiftKey||y.button||y.defaultPrevented)return;let J=y.target.closest("a");if(!J)return;if(Q.handleClicks===!1&&!J.hasAttribute("x-link")||J.hasAttribute("data-native")||J.hasAttribute("native"))return;let b=J.getAttribute("href"),K=J.getAttribute("target");if(b&&(!K||/^_?self$/i.test(K)))j.navigate(b),y.preventDefault()})};var jj="pinecone-router";var yj="7.0.0-beta.2";var Hj=function(j){let y=j.reactive(o(jj,yj));window.PineconeRouter=y,document.addEventListener("alpine:initialized",()=>{if(Q.hash==!1)y.navigate(location.pathname+location.search,!1,!0);else y.navigate(location.hash.substring(1),!1,!0)}),window.addEventListener("popstate",()=>{if(Q.hash){if(window.location.hash!="")y.navigate(window.location.hash.substring(1),!0)}else y.navigate(window.location.pathname,!0)}),t(y),document.addEventListener("pinecone:end",()=>j.nextTick(s),{once:!0}),l(j,y),r(j,y),a(j,y),j.$router=y,j.magic("router",()=>y),j.magic("history",()=>y.history),j.magic("params",()=>y.context.params)},Jj=Hj;var Ky=Jj;export{Ky as default};

//# debugId=881F59EDE70035AF64756E2164756E21
//# sourceMappingURL=router.esm.js.map
