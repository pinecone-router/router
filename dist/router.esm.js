async function _(q,j,z){for(let J=0;J<q.length;J++)if(typeof q[J]=="function"){if(z.cancelHandlers)return z.cancelHandlers=!1,0;let Z;if(q[J].constructor.name==="AsyncFunction")Z=await q[J](j);else Z=q[J](j);if(Z==0)return 0}return 1}var I=(q)=>`Invalid template type: ${q}. Expected an array of strings.`,T=(q)=>`Can't find an element with the supplied target ID: ${q}`,P=(q)=>`Route already exists: ${q}`;var M="Directives can only be used on template elements.",g="x-template must be used on the same element as x-route.",A="x-template cannot be used alongside an inline template (template element should not have a child).",x="x-handler must be set on the same element as x-route, or on any element with the modifier .global.",E="A route's path may not have a hash character.",f="templateTargetId must be specified for programmatically added templates.",c=(q)=>`Invalid handler type: ${q}.`;class G extends Error{constructor(q){super("Pinecone Router Error: "+q);this.name="PineconeRouterError",Object.setPrototypeOf(this,G.prototype)}}var m=(q,j,z,J)=>({route:q,path:j,params:q.params,query:window.location.search.substring(1),hash:window.location.hash.substring(1),navigationStack:z,navigationIndex:J});function U(q,{templateTargetId:j="",templates:z=[],handlers:J=[],preload:Z=!1}={}){return{pattern:q.indexOf(":")!==-1?o(q):void 0,programmaticTemplates:!!z.length,cancelHandlers:!1,handlersDone:!1,templateTargetId:j,params:{},templates:z,handlers:J,preload:Z,path:q,match($){if(this.params={},this.pattern){let K=$.match(this.pattern);if(!K)return!1;return this.params={...K.groups},!0}return $===this.path}}}var o=(q)=>{q=q.endsWith("/")?q.slice(0,-1):q;let j,z=q.split("/").map((J,Z)=>{if(Z==0)return J;if(!J.startsWith(":"))return"/"+J;let X=J.substring(1),$="[^/]+";if(X.endsWith("?"))X=X.slice(0,-1),j=!0;else if(X.endsWith("*"))X=X.slice(0,-1),$=".*";else if(X.includes("(")){let K=X.match(/\((.+?)\)/);if(K)X=X.substring(0,X.indexOf("(")),$=K[1]}if(j)return`(?:/(?<${X}>${$}))?`;else return`/(?<${X}>${$})`}).join("");return new RegExp(`^${z}/?$`)};var Q={},O={},L=new Set,l=(q,j)=>{document.dispatchEvent(new CustomEvent("pinecone-fetch-error",{detail:{error:q,url:j}}))},S=(q,j,z,J,Z)=>{if(L.has(z))return;L.add(z);let X=j.content;if(!X)return;let $=[];X.querySelectorAll("script").forEach((K)=>{let B=document.createElement("script");Array.from(K.attributes).forEach((F)=>B.setAttribute(F.name,F.value)),B.textContent=K.textContent,K.parentNode?.replaceChild(B,K)}),Array.from(X.children).forEach((K)=>{let B=K.cloneNode(!0);$.push(B),q.addScopeToNode(B,{},j)}),q.mutateDom(()=>{if(J!=null)J.replaceChildren(...$);else j.after(...$);$.forEach((K)=>{q.initTree(K)})}),j._x_PineconeRouter_CurrentTemplate=$,j._x_PineconeRouter_CurrentTemplateUrls=Z,j._x_PineconeRouter_undoTemplate=()=>{j._x_PineconeRouter_CurrentTemplate?.forEach((K)=>K.remove()),delete j._x_PineconeRouter_CurrentTemplate},q.nextTick(()=>L.delete(z))},w=(q)=>{if(q._x_PineconeRouter_undoTemplate)q._x_PineconeRouter_undoTemplate(),delete q._x_PineconeRouter_undoTemplate},V=(q,j,z,J,Z,X)=>{if(z._x_PineconeRouter_CurrentTemplateUrls!=null&&z._x_PineconeRouter_CurrentTemplateUrls!=Z)w(z),z.innerHTML="";if(z._x_PineconeRouter_CurrentTemplate)return;if(z.content.firstElementChild){if(S(q,z,J,X,Z),j.startEventDispatched)j.endLoading()}else if(Z)if(Z.every(($)=>O[$]))Z.forEach(($)=>{z.innerHTML+=O[$]}),S(q,z,J,X,Z),j.endLoading();else y(Z,z).then(()=>S(q,z,J,X,Z)).finally(()=>j.endLoading())},R=(q,j)=>{return q.map((z)=>{return z.replace(/:([^/.]+)/g,(J,Z)=>{return j[Z]||Z})})},h=async(q)=>{if(Q.hasOwnProperty(q))return Q[q];else if(O[q])return O[q];else return Q[q]=fetch(q).then((j)=>{if(!j.ok){l(j.statusText,q);return}return j.text()}).then((j)=>{if(!j)return"";return O[q]=j,delete Q[q],j}),Q[q]},d=(q)=>{q.forEach((j)=>h(j))},y=(q,j)=>{return Promise.all(q.map((z)=>h(z))).then((z)=>{return j.innerHTML=z.join(""),j.innerHTML})};var b=(q,j)=>j.findIndex((z)=>z.path==q),D=(q,j,z)=>{if(q.indexOf(j)===-1)return z;let J=q[q.indexOf(j)+1];if(!J)return z;if(j==="target"){let Z=J.match(/([a-z0-9_-]+)/);if(Z)return Z[1]}return J},H=(q,j)=>{if(j!="/"&&!q.startsWith(j))q=j+q;if(q==j&&!q.endsWith("/"))q+="/";return q},N=(q,j)=>{let z=q??j??"",J=document.getElementById(z)??void 0;if(z.length&&J==null)throw new G(T(z));return J};var u=(q)=>{return{version:q,name:"pinecone-router",notfound:U("notfound",{}),routes:[],globalHandlers:[],context:{route:void 0,path:"",params:{},query:window.location.search.substring(1),hash:window.location.hash.substring(1),navigationStack:[],navigationIndex:0},settings:{hash:!1,basePath:"/",templateTargetId:void 0,interceptLinks:!0,alwaysSendLoadingEvents:!1},loadStart:new Event("pinecone-start"),loadEnd:new Event("pinecone-end"),endEventDispatched:!1,startEventDispatched:!1,startLoading:function(){if(!this.startEventDispatched)document.dispatchEvent(this.loadStart);this.startEventDispatched=!0},endLoading:function(){if(this.startEventDispatched&&!this.endEventDispatched)document.dispatchEvent(this.loadEnd);this.endEventDispatched=!0},add:function(z,J){if(this.routes.find((Z)=>Z.path==z)!=null)throw new G(P(z));if(J.templates&&J.preload)d(J.templates);return this.routes.push(U(z,J))-1},remove:function(z){this.routes=this.routes.filter((J)=>J.path!=z)},redirect:function(z){return this.navigate(z),0},canGoBack:function(){return this.context.navigationIndex>0},back:function(){this.navigate(this.context.navigationStack[this.context.navigationIndex-1],!1,!1,this.context.navigationIndex-1)},canGoForward:function(){return this.context.navigationIndex<this.context.navigationStack.length-1},forward:function(){this.navigate(this.context.navigationStack[this.context.navigationIndex+1],!1,!1,this.context.navigationIndex+1)},navigate:async function(z,J=!1,Z=!1,X){if(this.startEventDispatched=!1,this.endEventDispatched=!1,!z)z="/";if(H(z,this.settings.basePath),X!=null)this.context.navigationIndex=X;else if(z!=this.context.path)if(this.context.navigationIndex!==this.context.navigationStack.length-1)this.context.navigationStack=this.context.navigationStack.slice(0,this.context.navigationIndex+1),this.context.navigationStack.push(z),this.context.navigationIndex=this.context.navigationStack.length-1;else this.context.navigationStack.push(z),this.context.navigationIndex++;let $=this.routes.find((K)=>K.match(z))??this.notfound;if($.handlersDone=!$.handlers.length&&!this.globalHandlers.length,this.settings.alwaysSendLoadingEvents||($.handlers.length||this.globalHandlers.length||$.templates.length)&&this.context.path!=z)this.startLoading();if(this.context=m($,z,this.context.navigationStack,this.context.navigationIndex),!J){let K="";if(this.settings.hash)K="#",K+=z;else K=z,K+=window.location.hash;if(!Z)history.pushState({path:K},"",K);else if(this.settings.hash){if(z=="/")return this.navigate("/",!1,!1)}}if($&&($.handlers.length||this.globalHandlers.length)){if($.cancelHandlers=!1,await _(this.globalHandlers.concat($.handlers),this.context,$)==0){this.endLoading();return}if($.handlersDone=!0,!$.templates)this.endLoading()}if($.programmaticTemplates){let K=document.getElementById($.templateTargetId??this.settings.templateTargetId);if(!K)throw new G(f);y($.templates,K).then(()=>{this.endLoading()})}if(this.settings.alwaysSendLoadingEvents)this.endLoading()}}};var s=(q,j)=>{q.directive("template",(z,{expression:J,modifiers:Z},{evaluate:X,cleanup:$,Alpine:K,effect:B})=>{if(!(z instanceof HTMLTemplateElement))throw new G(M);let F=z;if(F.content.firstElementChild!=null)throw new G(A);if(!(J.startsWith("[")&&J.endsWith("]"))&&!(J.startsWith("Array(")&&J.endsWith(")")))J=`['${J}']`;let W=X(J),Y;if(typeof W=="object"&&Array.isArray(W))Y=W;else throw new G(I(typeof W));let k=N(D(Z,"target"),j.settings.templateTargetId);if(Z.includes("preload"))y(Y,F);if(Z.includes("component"))K.nextTick(()=>{V(K,j,F,J,Y,k)});else{if(F._x_PineconeRouter_route==null)throw new G(g);let v=F._x_PineconeRouter_route,C=v=="notfound"?j.notfound:j.routes[b(v,j.routes)];C.templates=Y,K.nextTick(()=>{B(()=>{if(C.handlersDone&&j.context.route==C){if(Z.includes("interpolate"))Y=R(C.templates,C.params);V(K,j,F,J,Y,k)}else w(F)})})}$(()=>{F._x_PineconeRouter_undoTemplate&&F._x_PineconeRouter_undoTemplate()})})};var i=(q,j)=>{q.directive("handler",(z,{expression:J,modifiers:Z},{evaluate:X,cleanup:$})=>{if(!Z.includes("global")&&!z._x_PineconeRouter_route)throw new G(x);let K;if(!(J.startsWith("[")&&J.endsWith("]"))&&!(J.startsWith("Array(")&&J.endsWith(")")))J=`[${J}]`;let B=X(J);if(typeof B=="object")K=B;else throw new G(c(typeof B));for(let W=0;W<K.length;W++)K[W]=K[W].bind(q.$data(z));let F;if(Z.includes("global"))j.globalHandlers=K;else{let W=z._x_PineconeRouter_route;F=W=="notfound"?j.notfound:j.routes[b(W,j.routes)],F.handlers=K}$(()=>{if(Z.includes("global"))j.globalHandlers=[];else F.handlers=[],F.handlersDone=!0,F.cancelHandlers=!1})}).before("template")};var p=(q,j)=>{q.directive("route",(z,{expression:J,modifiers:Z},{cleanup:X,effect:$})=>{let K=J;if(!(z instanceof HTMLTemplateElement))throw new G(M);let B=z;if(K.indexOf("#")>-1)throw new G(E);let F=N(D(Z,"target"),j.settings.templateTargetId),W;if(K!="notfound")K=H(K,j.settings.basePath),W=j.add(K,{});let Y=W!=null?j.routes[W]:j.notfound;if(B._x_PineconeRouter_route=K,B.content.firstElementChild!=null)q.nextTick(()=>{$(()=>{Y.handlersDone&&j.context.route?.path==K?V(q,j,B,J,void 0,F):w(B)})});X(()=>{B._x_PineconeRouter_undoTemplate&&B._x_PineconeRouter_undoTemplate(),j.remove(K),delete B._x_PineconeRouter_route})}).before("handler")};var n=(q)=>{function j(z){if(!z||!z.getAttribute)return;let J=z.getAttribute("href"),Z=z.getAttribute("target");if(!J||!J.match(/^\//g)||Z&&!Z.match(/^_?self$/i))return;return J}window.document.body.addEventListener("click",function(z){if(z.ctrlKey||z.metaKey||z.altKey||z.shiftKey||z.button||z.defaultPrevented)return;if(q.context.route&&!q.context.route?.handlersDone)q.context.route.cancelHandlers=!0,q.endLoading();let J=z.target;do if(J instanceof HTMLAnchorElement&&J.getAttribute("href")){if(q.settings.interceptLinks==!1&&!J.hasAttribute("x-link"))return;if(J.hasAttribute("data-native")||J.hasAttribute("native"))return;let Z=j(J);if(Z){if(q.navigate(Z),z.stopImmediatePropagation)z.stopImmediatePropagation();if(z.stopPropagation)z.stopPropagation();z.preventDefault()}break}while(J=J.parentNode)})};var r=function(q){let j=q.reactive(u("7.0.0"));window.PineconeRouter=j,document.addEventListener("alpine:initialized",()=>{if(j.settings.hash==!1)j.navigate(location.pathname+location.search,!1,!0);else j.navigate(location.hash.substring(1),!1,!0)}),window.addEventListener("popstate",()=>{if(j.settings.hash){if(window.location.hash!="")j.navigate(window.location.hash.substring(1),!0)}else j.navigate(window.location.pathname,!0)}),s(q,j),i(q,j),p(q,j),q.$router=j,q.$params=j.context.params||{},q.magic("router",()=>j),q.magic("params",(z,{Alpine:J})=>J.$params),n(j)},a=r;var xq=a;export{xq as default};

//# debugId=DCED47712B76E2AA64756E2164756E21
//# sourceMappingURL=router.esm.js.map
