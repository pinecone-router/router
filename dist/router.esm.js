var z1=(b)=>`Invalid expression type. Expression: ${b}`,P=(b)=>`Can't find an element with target ID: ${b}`,E=(b)=>`Route already exists: ${b}`;var K1=(b)=>`x-${b} must be used on the same template as x-route`,f=(b)=>`Path: ${b} was not found`;function y(b){if(b.tagName.toLowerCase()!=="template")throw new TypeError("Directives can only be used on template elements.")}function V(b){if(y(b),b._x_PineconeRouter_route===void 0)throw new TypeError(K1("template"))}function L(b){if(typeof b!="object"||!Array.isArray(b))throw new TypeError(z1(b))}var G={hash:!1,basePath:"",globalHandlers:[],handleClicks:!0,targetID:void 0,preload:!1,fetchOptions:{},pushState:!0},R=(b)=>{return G={...G,...b},G};var A=(b,j,J)=>{if(b.indexOf(j)===-1)return J;let z=b[b.indexOf(j)+1];if(!z)return J;if(j==="target"){let Z=z.match(/([a-z0-9_-]+)/);if(Z)return Z[1]}return z},C=(b)=>{if(b=="notfound"||G.hash)return b;if(!b.startsWith(G.basePath))b=G.basePath+b;return b},U=(b)=>{return/^\[.*\]$|^Array\(.*\)$/.test(b.trim())},v=(b,j)=>{let J=b??j??"",z=document.getElementById(J);if(J&&!z)throw new ReferenceError(P(J));return z??void 0},x=(b)=>{b.querySelectorAll("script").forEach((j)=>{let J=document.createElement("script");Array.from(j.attributes).forEach((z)=>J.setAttribute(z.name,z.value)),J.textContent=j.textContent,j.parentNode?.replaceChild(J,j)})};var I=new Set,_=new Map,N=new Map,w=new Map,g=(b,j)=>{document.dispatchEvent(new CustomEvent("pinecone:fetch-error",{detail:{error:b,url:j}}))},c=(b,j,J,z,Z)=>{let Q=j.id+J;if(I.has(Q))return;I.add(Q);let Y=j.content,H=Array(Y.childElementCount);x(Y);let W=Array.from(Y.children);for(let K=0;K<W.length;K++)if(H[K]=W[K].cloneNode(!0),z)b.addScopeToNode(H[K],{},z);else b.addScopeToNode(H[K],{},j);b.mutateDom(()=>{if(z)z.replaceChildren(...H);else j.after(...H);H.forEach((K)=>{b.initTree(K)})}),j._x_PineconeRouter_template=H,j._x_PineconeRouter_templateUrls=Z,j._x_PineconeRouter_undoTemplate=()=>{b.mutateDom(()=>{H.forEach((K)=>{b.destroyTree(K),K.remove()})}),delete j._x_PineconeRouter_template},b.nextTick(()=>I.delete(Q))},k=(b)=>{b._x_PineconeRouter_undoTemplate?.(),delete b._x_PineconeRouter_undoTemplate},d=async(b,j,J,z,Z)=>{if(j._x_PineconeRouter_templateUrls!=null&&j._x_PineconeRouter_templateUrls!=z)k(j),j.innerHTML="";if(j._x_PineconeRouter_template)return;if(j.content.childElementCount){c(b,j,J,Z,z);return}if(z)return n(z,j).then(()=>c(b,j,J,Z,z))},m=(b,j)=>{return b.map((J)=>J.replace(/:([^/.]+)/g,(z,Z)=>j[Z]||Z))},h=async(b,j="high")=>{if(b=C(b),_.has(b))return _.get(b);if(N.has(b))return N.get(b);let J=fetch(b,{...G.fetchOptions,priority:j}).then((z)=>{if(!z.ok)return g(z.statusText,b),"";return z.text()}).then((z)=>{if(z)_.set(b,z);return N.delete(b),z||""}).catch((z)=>{if(z instanceof TypeError)g(z.message,b);return""});return N.set(b,J),J},u=(b,j)=>{w.set(b,j)},p=()=>{for(let[b,j]of w){if(j)n(b,j,"low");else b.map((J)=>h(J,"low"));w.delete(b)}},n=(b,j,J="high")=>Promise.all(b.map((z)=>h(z,J))).then((z)=>{j.innerHTML=z.join("")});var Z1=(b,j)=>{b.directive("template",(J,{expression:z,modifiers:Z},{evaluate:Q,cleanup:Y,Alpine:H,effect:W})=>{V(J);let K=v(A(Z,"target"),G.targetID),$=J._x_PineconeRouter_route,M,X=Z.includes("interpolate"),q=j.routes.get($);if(q._template_element=J,z!=""){if(!U(z))z=`['${z}']`;let F=Q(z);if(L(F),M=F,!X&&(G.preload||Z.includes("preload")))u(M,J);q.templates=M}let B=(F)=>{if(j.context.route?.path===$){if(F&&X)F=m(F,j.context.params);d(H,J,z,F,K).then(()=>{j.loading=!1})}else k(J)},O=W(()=>B(M));Y(()=>{J._x_PineconeRouter_undoTemplate?.(),q.templates=[],H.release(O)})})},o=Z1;var $1=(b,j)=>{b.directive("handler",(J,{expression:z,modifiers:Z},{evaluate:Q,cleanup:Y})=>{if(!U(z))z=`[${z}]`;let H=Q(z);L(H);let W=H;for(let $=0;$<W.length;$++)W[$]=W[$].bind(b.$data(J));let K;if(Z.includes("global"))G.globalHandlers=W;else{V(J);let $=J._x_PineconeRouter_route;K=j.routes.get($),K.handlers=W}Y(()=>{if(Z.includes("global"))G.globalHandlers=[];else K.handlers=[]})}).before("template")},i=$1;var G1=(b,j)=>{b.directive("route",(J,{expression:z,value:Z},{cleanup:Q})=>{let Y=G.hash?z:C(z);if(y(J),Y!="notfound")j.add(Y,{name:Z});J._x_PineconeRouter_route=Y,Q(()=>{J.removeAttribute("x-template"),J.removeAttribute("x-handler"),j.remove(Y)})}).before("handler")},s=G1;var a=()=>{return{entries:[],index:0,canGoBack:function(){return this.index>0},back:function(){this.to(this.index-1)},canGoForward:function(){return this.index<this.entries.length-1},forward:function(){this.to(this.index+1)},to:function(b){if(b in this.entries)this.router?.navigate(this.entries[b],!1,!1,b)},push:function(b,j){if(this.index<this.entries.length-1)this.entries=this.entries.slice(0,this.index+1);if(this.entries.push(b),this.index=this.entries.length-1,j)this.pushState(b)},pushState:function(b){if(!G.pushState)return;let j=G.hash&&!b.startsWith("#")?"#"+b:b,J={path:j};history.pushState(J,"",j)},setRouter(b){this.router=b}}};var Q1=(b,{templates:j=[],handlers:J=[],name:z}={})=>({pattern:Y1(b),name:z||b,templates:j,handlers:J,path:b,match(Z){let Q=this.pattern.exec(Z);if(Q)return{...Q.groups}}});function Y1(b){let J=b.split("/").filter(Boolean).map((z)=>{if(!z.startsWith(":"))return"/"+z;let[,Z,Q,Y]=z.match(/^:(\w+)([?+*]?)(?:\.(.+))?$/)||[],H=Q==="*"||Q==="+",W=Q==="?"||Q==="*",$=`(?<${Z}>${H?W?".*?":".+":"[^/]+?"})`,M=Y?`\\.${Y}`:"",X=$+M;if(W)return`(?:/${X})?`;return`/${X}`}).join("");return new RegExp(`^${J}/?$`,"i")}var S=Q1;var T=(b,j,J)=>{return{path:b,params:j,route:J}};async function l(b,j,J){let z;return new Promise(async(Z,Q)=>{J.signal.addEventListener("abort",()=>Q());for(let Y of b){if(J.signal.aborted)return;let H={...j,data:z};try{z=await Y(H,J)}catch(W){Q(W)}}Z()})}var r=(b,j,J)=>{let z=S("notfound",{handlers:[(K)=>console.error(new ReferenceError(f(K.path)))],name:"notfound"}),Z=new Map([["notfound",z]]),Q=T(J,{}),Y=null,H=!1,W={name:b,version:j,history:a(),routes:Z,context:Q,get loading(){return H},set loading(K){if(H==K)return;H=K,document.dispatchEvent(new Event(K?"pinecone:start":"pinecone:end"))},settings:(K)=>R(K),add:function(K,$){if(K!="notfound"){if(!G.hash)K=C(K);if(this.routes.has(K))throw new Error(E(K))}let M;if($.templates?.length){M=document.createElement("template"),M._x_PineconeRouter_route=K;let X="x-template";if($.targetID)X+=` .target.${$.targetID}`;if($.interpolate)X+=" .interpolate";if($.preload)X+=" .preload";M.setAttribute("x-template",JSON.stringify($.templates)),document.body.appendChild(M)}this.routes.set(K,S(K,{...$,preload:$.preload||G.preload}))},remove:function(K){let $=this.routes.get(K);if($?._template_element){let M=$._template_element;M._x_PineconeRouter_undoTemplate?.(),M.remove(),$._template_element=void 0}return this.routes.delete(K)},navigate:async function(K,$,M,X){if(Y)Y.abort();Y=new AbortController,this.loading=!0,K=C(K);let q=K.split("?")[0]||"/",{route:B,params:O}=this.match(q),F=T(q,O,B),D=G.globalHandlers.concat(B.handlers);if(D.length){try{await l(D,F,Y)}catch(M1){this.loading=!1;return}if(!B.templates)this.loading=!1}if(X!=null)this.history.index=X,this.history.pushState(K);else if(M||K!=this.context.path)this.history.push(K,!$&&!M);if(this.context=F,!B.templates.length)this.loading=!1},match:function(K){let $=this.routes.get("notfound"),M={};for(let[X,q]of this.routes){let B=q.match(K);if(B){M=B,$=q;break}}return{route:$,params:M}}};return W.history.setRouter(W),W};var t=(b)=>{window.document.body.addEventListener("click",(j)=>{if(j.ctrlKey||j.metaKey||j.altKey||j.shiftKey||j.button||j.defaultPrevented)return;let J=j.target.closest("a");if(!J)return;if(G.handleClicks===!1&&!J.hasAttribute("x-link")||J.hasAttribute("data-native")||J.hasAttribute("native"))return;let z=J.getAttribute("href"),Z=J.getAttribute("target");if(z&&(!Z||/^_?self$/i.test(Z)))b.navigate(z),j.preventDefault()})};var b1="pinecone-router",j1="7.4.0";var H1=function(b){let j=()=>{return G.hash?location.hash.substring(1):location.pathname},J=b.reactive(r(b1,j1,j()));window.PineconeRouter=J,document.addEventListener("alpine:initialized",()=>{J.navigate(j(),!1,!0)}),window.addEventListener("popstate",()=>{J.navigate(G.hash?window.location.hash.substring(1):window.location.pathname,!0)}),t(J),document.addEventListener("pinecone:end",()=>b.nextTick(p),{once:!0}),o(b,J),i(b,J),s(b,J),b.$router=J,b.magic("router",()=>J),b.magic("history",()=>J.history),b.magic("params",()=>J.context.params)},J1=H1;var $3=J1;export{$3 as default};

//# debugId=A32A2865DA3ACAE664756E2164756E21
//# sourceMappingURL=router.esm.js.map
