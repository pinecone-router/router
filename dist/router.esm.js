function X(b,{targetID:y,templates:j=[],handlers:J=[]}={}){return{programmaticTemplates:j.length>0,targetID:y,templates:j,handlers:J,pattern:e(b),path:b,match(Z){let $=this.pattern.exec(Z);if($)return{...$.groups}}}}function e(b){let y,j,J,K="",Z=b.split("/");Z[0]||Z.shift();while(j=Z.shift())if(j.startsWith(":")){y=j.indexOf("?",1),J=j.indexOf(".",1);let $=j.substring(1,Math.min(...[y,J,j.length].filter((Y)=>Y>0))),C=$.endsWith("*")||$.endsWith("+"),z=$.endsWith("*");if(C)$=$.slice(0,-1),K+=z?`(?:/(?<${$}>.*)?)?`:`/(?<${$}>.+)`;else if(K+=y>0&&J<0?`(?:/(?<${$}>[^/]+?))?`:`/(?<${$}>[^/]+?)`,J>0)K+=(y>0?"?":"")+"\\"+j.substring(J)}else K+="/"+j;return new RegExp("^"+K+"/?$","i")}var f=()=>{return{entries:[],index:0,canGoBack:function(){return this.index>0},back:function(){this.to(this.index-1)},canGoForward:function(){return this.index<this.entries.length-1},forward:function(){this.to(this.index+1)},to:function(b){if(b in this.entries)this.router?.navigate(this.entries[b],!1,!1,b)},push:function(b,y,j){if(this.index<this.entries.length-1)this.entries=this.entries.slice(0,this.index+1);if(this.entries.push(b),this.index=this.entries.length-1,y)this.pushState(b,j)},pushState:function(b,y){let j=y?"#"+b:b;history.pushState({path:j},"",j)},setRouter(b){this.router=b}}};var G={hash:!1,basePath:"/",globalHandlers:[],alwaysLoad:!1,handleClicks:!0,targetID:void 0},I=(b)=>{G={...G,...b}};async function E(b,y,j){let J;return new Promise(async(K,Z)=>{j.signal.addEventListener("abort",()=>Z());for(let $ of b){if(j.signal.aborted)return;let C={...y,data:J};try{J=await $(C,j)}catch(z){Z(z)}}K()})}var D=(b,y,j)=>({path:b,route:j,params:y});var b2=(b)=>`Invalid expression type. Expression: ${b}.`,v=(b)=>`Can't find an element with the supplied target ID: ${b}`,A=(b)=>`Route already exists: ${b}`;var y2="Directives can only be used on template elements.",j2=(b)=>`x-${b} must be used on the same template as x-route.`,g="targetID must be specified for programmatically added templates.",R=(b)=>`Path: ${b} was not found.`;function k(b){if(b.tagName.toLowerCase()!=="template")throw new TypeError(y2)}function V(b){if(k(b),b._x_PineconeRouter_route===void 0)throw new TypeError(j2("template"))}function L(b){if(typeof b!="object"||!Array.isArray(b))throw new TypeError(b2(b))}var c=(b,y,j)=>{if(b.indexOf(y)===-1)return j;let J=b[b.indexOf(y)+1];if(!J)return j;if(y==="target"){let K=J.match(/([a-z0-9_-]+)/);if(K)return K[1]}return J},U=(b,y)=>{if(b=="notfound")return b;if(y!="/"&&!b.startsWith(y))b=y+b;return b},d=(b,y)=>{let j=b??y??"",J=document.getElementById(j);if(j.length&&!J)throw new ReferenceError(v(j));return J??void 0};var _=new Map,O=new Map,N=new Set,J2=(b,y)=>{document.dispatchEvent(new CustomEvent("pinecone:fetch-error",{detail:{error:b,url:y}}))},x=(b,y,j,J,K)=>{let Z=y.id+j;if(N.has(Z))return;N.add(Z);let $=y.content,C=Array($.childElementCount);$.querySelectorAll("script").forEach((z)=>{let Y=document.createElement("script");Array.from(z.attributes).forEach((B)=>Y.setAttribute(B.name,B.value)),Y.textContent=z.textContent,z.parentNode?.replaceChild(Y,z)}),Array.from($.children).forEach((z,Y)=>{let B=z.cloneNode(!0);C[Y]=B,b.addScopeToNode(B,{},y)}),b.mutateDom(()=>{if(J)J.replaceChildren(...C);else y.after(...C);C.forEach((z)=>{b.initTree(z)})}),y._x_PineconeRouter_template=C,y._x_PineconeRouter_templateUrls=K,y._x_PineconeRouter_undoTemplate=()=>{b.mutateDom(()=>{C.forEach((z)=>{b.destroyTree(z),z.remove()})}),delete y._x_PineconeRouter_template,delete y._x_PineconeRouter_templateUrls},b.nextTick(()=>N.delete(Z))},S=(b)=>{if(b._x_PineconeRouter_undoTemplate)b._x_PineconeRouter_undoTemplate(),delete b._x_PineconeRouter_undoTemplate},m=async(b,y,j,J,K)=>{if(y._x_PineconeRouter_templateUrls!=null&&y._x_PineconeRouter_templateUrls!=J)S(y),y.innerHTML="";if(y._x_PineconeRouter_template)return;if(y.content.childElementCount){x(b,y,j,K,J);return}if(J)return H(J,y).then(()=>x(b,y,j,K,J))},h=(b,y)=>{return b.map((j)=>{return j.replace(/:([^/.]+)/g,(J,K)=>{return y[K]||K})})},u=async(b)=>{if(b=U(b,G.basePath),_.has(b))return _.get(b);if(O.has(b))return O.get(b);let y=fetch(b).then((j)=>{if(!j.ok)return J2(j.statusText,b),"";return j.text()}).then((j)=>{if(j)_.set(b,j);return O.delete(b),j||""});return O.set(b,y),y},i=(b)=>{b.forEach(u)},H=(b,y)=>Promise.all(b.map(u)).then((j)=>{y.innerHTML=j.join("")});var n=(b,y)=>{let j=X("notfound",{handlers:[(z)=>console.error(new ReferenceError(R(z.path)))]}),J=new Map([["notfound",j]]),K=D("",{}),Z=null,$=!1,C={name:b,version:y,history:f(),routes:J,context:K,get loading(){return $},set loading(z){if($==z)return;$=z,document.dispatchEvent(new Event(z?"pinecone:start":"pinecone:end"))},get settings(){return G},set settings(z){I(z)},add:function(z,Y){if(z!="notfound"){if(this.routes.has(z))throw new Error(A(z))}if(Y.templates&&Y.preload)i(Y.templates);this.routes.set(z,X(z,Y))},remove:function(z){this.routes.delete(z)},navigate:async function(z,Y,B,q){if(Z)Z.abort();if(Z=new AbortController,z=U(z||"/",G.basePath),B&&G.hash&&z==="/")return this.navigate("/",!1,!1);let F,W={};for(let[M,P]of this.routes){let T=P.match(z);if(T){W=T,F=P;break}}if(!F)F=this.routes.get("notfound");let Q=D(z,W,F),w=G.globalHandlers.concat(Q.route.handlers);if(G.alwaysLoad||(w.length||Q.route.templates.length)&&this.context.path!=z)this.loading=!0;if(w.length){try{await E(w,Q,Z)}catch(M){this.loading=!1;return}if(!Q.route.templates)this.loading=!1}if(q!=null)this.history.index=q,this.history.pushState(z,G.hash);else if(z!=this.context.path)this.history.push(z,!Y&&!B,G.hash);if(this.context=Q,Q.route.programmaticTemplates){let M=document.getElementById(Q.route.targetID??G.targetID??"");if(!M)throw new Error(g);H(Q.route.templates,M).finally(()=>this.loading=!1)}if(G.alwaysLoad)this.loading=!1}};return document.addEventListener("pinecone:start",()=>{C.loading=!0}),document.addEventListener("pinecone:end",()=>{C.loading=!1}),C.history.setRouter(C),C};var z2=(b,y)=>{b.directive("template",(j,{expression:J,modifiers:K},{evaluate:Z,cleanup:$,Alpine:C,effect:z})=>{V(j);let Y=d(c(K,"target"),y.settings.targetID),B=j._x_PineconeRouter_route,q;if(J!=""){if(J=J.trim(),!(J.startsWith("[")&&J.endsWith("]"))&&!(J.startsWith("Array")&&J.endsWith(")")))J=`['${J}']`;let W=Z(J);if(L(W),q=W,K.includes("preload"))H(q,j);let Q=y.routes.get(B);Q.templates=q}let F=(W)=>{if(y.context.route?.path===B){if(W&&K.includes("interpolate"))W=h(W,y.context.params);m(C,j,J,W,Y).then(()=>{y.loading=!1,y.settings.alwaysLoad=!1})}else S(j)};C.nextTick(()=>z(()=>F(q))),$(()=>{j._x_PineconeRouter_undoTemplate&&j._x_PineconeRouter_undoTemplate()})})},p=z2;var K2=(b,y)=>{b.directive("handler",(j,{expression:J,modifiers:K},{evaluate:Z,cleanup:$})=>{if(J=J.trim(),!(J.startsWith("[")&&J.endsWith("]"))&&!(J.startsWith("Array")&&J.endsWith(")")))J=`[${J}]`;let C=Z(J);L(C);let z=C;for(let B=0;B<z.length;B++)z[B]=z[B].bind(b.$data(j));let Y;if(K.includes("global"))y.settings.globalHandlers=z;else{V(j);let B=j._x_PineconeRouter_route;Y=y.routes.get(B),Y.handlers=z}$(()=>{if(K.includes("global"))y.settings.globalHandlers=[];else Y.handlers=[]})}).before("template")},o=K2;var Z2=(b,y)=>{b.directive("route",(j,{expression:J},{cleanup:K})=>{let Z=J;if(k(j),Z!="notfound")y.add(Z,{});j._x_PineconeRouter_route=Z,K(()=>{y.routes.delete(Z),delete j._x_PineconeRouter_route})}).before("handler")},s=Z2;var l=(b)=>{window.document.body.addEventListener("click",(y)=>{if(y.ctrlKey||y.metaKey||y.altKey||y.shiftKey||y.button||y.defaultPrevented)return;let j=y.target.closest("a");if(!j)return;if(b.settings.handleClicks===!1&&!j.hasAttribute("x-link")||j.hasAttribute("data-native")||j.hasAttribute("native"))return;let J=j.getAttribute("href"),K=j.getAttribute("target");if(J&&J.startsWith(b.settings.basePath)&&(!K||/^_?self$/i.test(K)))b.navigate(J),y.preventDefault()})};var r="pinecone-router";var t="7.0.0";var $2=function(b){let y=b.reactive(n(r,t));window.PineconeRouter=y,document.addEventListener("alpine:initialized",()=>{if(y.settings.hash==!1)y.navigate(location.pathname+location.search,!1,!0);else y.navigate(location.hash.substring(1),!1,!0)}),window.addEventListener("popstate",()=>{if(y.settings.hash){if(window.location.hash!="")y.navigate(window.location.hash.substring(1),!0)}else y.navigate(window.location.pathname,!0)}),l(y),p(b,y),o(b,y),s(b,y),b.$router=y,b.$history=y.history,b.$params=y.context.params,b.magic("router",()=>y),b.magic("history",()=>y.history),b.magic("params",()=>y.context.params)},p2=$2;export{p2 as default};

//# debugId=C15124B9513B5AB264756E2164756E21
//# sourceMappingURL=router.esm.js.map
