var K1=(b)=>`Invalid expression type. Expression: ${b}`,E=(b)=>`Can't find an element with target ID: ${b}`,P=(b)=>`Route already exists: ${b}`;var Z1=(b)=>`x-${b} must be used on the same template as x-route`,f=(b)=>`Path: ${b} was not found`;function I(b){if(b.tagName!=="TEMPLATE")throw new TypeError("Directives can only be used on template elements.")}function V(b){if(I(b),b._x_PineconeRouter_route===void 0)throw new TypeError(Z1("template"))}function L(b){if(typeof b!="object"||!Array.isArray(b))throw new TypeError(K1(b))}var H={hash:!1,basePath:"",globalHandlers:[],handleClicks:!0,targetID:void 0,preload:!1,fetchOptions:{},pushState:!0},R=(b)=>{return H={...H,...b},H};var A=(b,J,j)=>{if(b.indexOf(J)===-1)return j;let z=b[b.indexOf(J)+1];if(!z)return j;if(J==="target"){let $=z.match(/([a-z0-9_-]+)/);if($)return $[1]}return z},C=(b)=>{if(b=="notfound"||H.hash)return b;if(!b.startsWith(H.basePath))b=H.basePath+b;return b},U=(b)=>{return/^\[.*\]$|^Array\(.*\)$/.test(b.trim())},x=(b,J)=>{let j=b??J??"",z=document.getElementById(j);if(j&&!z)throw new ReferenceError(E(j));return z??void 0},v=new Set,g=(b,J,j,z)=>{let $=b.getAttribute("x-run:on")||b.getAttribute("x-run.once:on");if($&&!z.evaluate(b,$))return;let M=b.id||j+J;if(b.hasAttribute("x-run.once")||b.hasAttribute("x-run.once:on")){if(v.has(M))return;v.add(M)}let Q=document.createElement("script");return Array.from(b.attributes).forEach((Z)=>Q.setAttribute(Z.name,Z.value)),Q.textContent=b.textContent,Q};var O=new Set,S=new Map,N=new Map,y=new Map,m=(b,J)=>{document.dispatchEvent(new CustomEvent("pinecone:fetch-error",{detail:{error:b,url:J}}))},d=(b,J,j,z,$)=>{if(O.has(j))return;O.add(j);let M=J.content,q=Array(M.childElementCount),Q=Array.from(M.children);for(let Z=0;Z<Q.length;Z++){if(q[Z]=Q[Z].cloneNode(!0),b.addScopeToNode(q[Z],{},J),z)b.addScopeToNode(q[Z],b.$data(q[Z]),z);if(q[Z].tagName==="SCRIPT"){let K=g(q[Z],Z,j,b);if(K)q[Z]=K;else q[Z].remove()}}b.mutateDom(()=>{if(z)z.replaceChildren(...q);else J.after(...q);q.forEach((Z)=>{b.initTree(Z)})}),J._x_PineconeRouter_template=q,J._x_PineconeRouter_templateUrls=$,J._x_PineconeRouter_undoTemplate=()=>{b.mutateDom(()=>{q.forEach((Z)=>{b.destroyTree(Z),Z.remove()})}),delete J._x_PineconeRouter_template},b.nextTick(()=>O.delete(j))},k=(b)=>{b._x_PineconeRouter_undoTemplate?.(),delete b._x_PineconeRouter_undoTemplate},c=async(b,J,j,z,$)=>{if(J._x_PineconeRouter_templateUrls!=null&&J._x_PineconeRouter_templateUrls!=z)k(J),J.innerHTML="";if(J._x_PineconeRouter_template)return;if(J.content.childElementCount){d(b,J,j,$,z);return}if(z)return n(z,J).then(()=>d(b,J,j,$,z))},h=(b,J)=>{return b.map((j)=>j.replace(/:([^/.]+)/g,(z,$)=>J[$]||$))},u=async(b,J="high")=>{if(b=C(b),S.has(b))return S.get(b);if(N.has(b))return N.get(b);let j=fetch(b,{...H.fetchOptions,priority:J}).then((z)=>{if(!z.ok)return m(z.statusText,b),"";return z.text()}).then((z)=>{if(z)S.set(b,z);return N.delete(b),z||""}).catch((z)=>{if(z instanceof TypeError)m(z.message,b);return""});return N.set(b,j),j},p=(b,J)=>{y.set(b,J)},o=()=>{for(let[b,J]of y){if(J)n(b,J,"low");else b.map((j)=>u(j,"low"));y.delete(b)}},n=(b,J,j="high")=>Promise.all(b.map((z)=>u(z,j))).then((z)=>{J.innerHTML=z.join("")});var $1=(b,J)=>{b.directive("template",(j,{expression:z,modifiers:$},{evaluate:M,cleanup:q,Alpine:Q,effect:Z})=>{V(j);let K=x(A($,"target"),H.targetID),G=j._x_PineconeRouter_route,Y,F=$.includes("interpolate"),X=J.routes.get(G);if(X._template_element=j,z!=""){if(!U(z))z=`['${z}']`;let W=M(z);if(L(W),Y=W,!F&&(H.preload||$.includes("preload")))p(Y,j);X.templates=Y}let B=(W)=>{if(J.context.route?.path===G){if(W&&F)W=h(W,J.context.params);c(Q,j,G,W,K).then(()=>{J.loading=!1})}else k(j)},D=Z(()=>B(Y));q(()=>{j._x_PineconeRouter_undoTemplate?.(),X.templates=[],Q.release(D)})})},i=$1;var q1=(b,J)=>{b.directive("handler",(j,{expression:z,modifiers:$},{evaluate:M,cleanup:q})=>{if(!U(z))z=`[${z}]`;let Q=M(z);L(Q);let Z=Q;for(let G=0;G<Z.length;G++)Z[G]=Z[G].bind(b.$data(j));let K;if($.includes("global"))H.globalHandlers=Z;else{V(j);let G=j._x_PineconeRouter_route;K=J.routes.get(G),K.handlers=Z}q(()=>{if($.includes("global"))H.globalHandlers=[];else K.handlers=[]})}).before("template")},s=q1;var G1=(b,J)=>{b.directive("route",(j,{expression:z,value:$},{cleanup:M})=>{let q=H.hash?z:C(z);if(I(j),q!="notfound")J.add(q,{name:$});j._x_PineconeRouter_route=q,M(()=>{j.removeAttribute("x-template"),j.removeAttribute("x-handler"),J.remove(q)})}).before("handler")},a=G1;var l=()=>{return{entries:[],index:0,canGoBack:function(){return this.index>0},back:function(){this.to(this.index-1)},canGoForward:function(){return this.index<this.entries.length-1},forward:function(){this.to(this.index+1)},to:function(b){if(b in this.entries)this.router?.navigate(this.entries[b],!1,!1,b)},push:function(b,J){if(this.index<this.entries.length-1)this.entries=this.entries.slice(0,this.index+1);if(this.entries.push(b),this.index=this.entries.length-1,J)this.pushState(b)},pushState:function(b){if(!H.pushState)return;let J=H.hash&&!b.startsWith("#")?"#"+b:b,j={path:J};history.pushState(j,"",J)},setRouter(b){this.router=b}}};var H1=(b,{templates:J=[],handlers:j=[],name:z}={})=>({pattern:M1(b),name:z||b,templates:J,handlers:j,path:b,match($){let M=this.pattern.exec($);if(M)return{...M.groups}}});function M1(b){let j=b.split("/").filter(Boolean).map((z)=>{if(!z.startsWith(":"))return"/"+z;let[,$,M,q]=z.match(/^:(\w+)([?+*]?)(?:\.(.+))?$/)||[],Q=M==="*"||M==="+",Z=M==="?"||M==="*",G=`(?<${$}>${Q?Z?".*?":".+":"[^/]+?"})`,Y=q?`\\.${q}`:"",F=G+Y;if(Z)return`(?:/${F})?`;return`/${F}`}).join("");return new RegExp(`^${j}/?$`,"i")}var w=H1;var T=(b,J,j)=>{return{path:b,params:J,route:j}};async function r(b,J,j){let z;return new Promise(async($,M)=>{j.signal.addEventListener("abort",()=>M());for(let q of b){if(j.signal.aborted)return;let Q={...J,data:z};try{z=await q(Q,j)}catch(Z){M(Z)}}$()})}var t=(b,J,j)=>{let z=w("notfound",{handlers:[(K)=>console.error(new ReferenceError(f(K.path)))],name:"notfound"}),$=new Map([["notfound",z]]),M=T(j,{}),q=null,Q=!1,Z={name:b,version:J,history:l(),routes:$,context:M,get loading(){return Q},set loading(K){if(Q==K)return;Q=K,document.dispatchEvent(new Event(K?"pinecone:start":"pinecone:end"))},settings:(K)=>R(K),add:function(K,G){if(K!="notfound"){if(!H.hash)K=C(K);if(this.routes.has(K))throw new Error(P(K))}let Y;if(G.templates?.length){Y=document.createElement("template"),Y._x_PineconeRouter_route=K;let F="x-template";if(G.targetID)F+=` .target.${G.targetID}`;if(G.interpolate)F+=" .interpolate";if(G.preload)F+=" .preload";Y.setAttribute("x-template",JSON.stringify(G.templates)),document.body.appendChild(Y)}this.routes.set(K,w(K,{...G,preload:G.preload||H.preload}))},remove:function(K){let G=this.routes.get(K);if(G?._template_element){let Y=G._template_element;Y._x_PineconeRouter_undoTemplate?.(),Y.remove(),G._template_element=void 0}return this.routes.delete(K)},navigate:async function(K,G,Y,F){if(q)q.abort();q=new AbortController,this.loading=!0,K=C(K);let X=K.split("?")[0]||"/",{route:B,params:D}=this.match(X),W=T(X,D,B),_=H.globalHandlers.concat(B.handlers);if(_.length)try{await r(_,W,q)}catch(Y1){this.loading=!1;return}if(F!=null)this.history.index=F,this.history.pushState(K);else if(Y||K!=this.context.path)this.history.push(K,!G&&!Y);if(!B.templates)this.loading=!1;this.context=W},match:function(K){let G=this.routes.get("notfound"),Y={};for(let[F,X]of this.routes){let B=X.match(K);if(B){Y=B,G=X;break}}return{route:G,params:Y}}};return Z.history.setRouter(Z),Z};var e=(b)=>{window.document.body.addEventListener("click",(J)=>{if(J.ctrlKey||J.metaKey||J.altKey||J.shiftKey||J.button||J.defaultPrevented)return;let j=J.target.closest("a");if(!j)return;if(H.handleClicks===!1&&!j.hasAttribute("x-link")||j.hasAttribute("data-native")||j.hasAttribute("native"))return;let z=j.getAttribute("href"),$=j.getAttribute("target");if(z&&(!$||/^_?self$/i.test($)))b.navigate(z),J.preventDefault()})};var j1="pinecone-router",J1="7.5.0";var Q1=function(b){let J=()=>{return H.hash?location.hash.substring(1):location.pathname},j=b.reactive(t(j1,J1,J()));window.PineconeRouter=j,document.addEventListener("alpine:initialized",()=>{j.navigate(J(),!1,!0)}),window.addEventListener("popstate",()=>{j.navigate(H.hash?window.location.hash.substring(1):window.location.pathname,!0)}),e(j),document.addEventListener("pinecone:end",()=>b.nextTick(o),{once:!0}),i(b,j),s(b,j),a(b,j),b.$router=j,b.magic("router",()=>j),b.magic("history",()=>j.history),b.magic("params",()=>j.context.params)},z1=Q1;var q3=z1;export{q3 as default};

//# debugId=66A2E19A9968CADA64756E2164756E21
//# sourceMappingURL=router.esm.js.map
