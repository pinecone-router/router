async function _(j,z,J){for(let K=0;K<j.length;K++)if(typeof j[K]=="function"){if(J.cancelHandlers)return J.cancelHandlers=!1,0;let Z;if(j[K].constructor.name==="AsyncFunction")Z=await j[K](z);else Z=j[K](z);if(Z==0)return 0}return 1}var I=(j)=>`Invalid template type: ${j}. Expected an array of strings.`,T=(j)=>`Can't find an element with the supplied target ID: ${j}`,P=(j)=>`Route already exists: ${j}`;var y="Directives can only be used on template elements.",g="x-template must be used on the same element as x-route.",A="x-template cannot be used alongside an inline template (template element should not have a child).",f="x-handler must be set on the same element as x-route, or on any element with the modifier .global.",E="A route's path may not have a hash character.",x="templateTargetId must be specified for programmatically added templates.",c=(j)=>`Invalid handler type: ${j}.`;class W extends Error{constructor(j){super("Pinecone Router Error: "+j);this.name="PineconeRouterError",Object.setPrototypeOf(this,W.prototype)}}var R=(j,z,J,K)=>({route:j,path:z,params:j.params,query:window.location.search.substring(1),hash:window.location.hash.substring(1),navigationStack:J,navigationIndex:K});function M(j,{templateTargetId:z="",templates:J=[],handlers:K=[],preload:Z=!1}={}){return{pattern:j.indexOf(":")!==-1?a(j):void 0,programmaticTemplates:!!J.length,cancelHandlers:!1,handlersDone:!1,templateTargetId:z,params:{},templates:J,handlers:K,preload:Z,path:j,match(q){if(this.params={},this.pattern){let $=q.match(this.pattern);if(!$)return!1;return this.params={...$.groups},!0}return q===this.path}}}var a=(j)=>{j=j.endsWith("/")?j.slice(0,-1):j;let z,J=j.split("/").map((K,Z)=>{if(Z==0)return K;if(!K.startsWith(":"))return"/"+K;let X=K.substring(1),q="[^/]+";if(X.endsWith("?"))X=X.slice(0,-1),z=!0;else if(X.endsWith("*"))X=X.slice(0,-1),q=".*";else if(X.includes("(")){let $=X.match(/\((.+?)\)/);if($)X=X.substring(0,X.indexOf("(")),q=$[1]}if(z)return`(?:/(?<${X}>${q}))?`;else return`/(?<${X}>${q})`}).join("");return new RegExp(`^${J}/?$`)};var Q={},O={},L=new Set,l=(j,z)=>{document.dispatchEvent(new CustomEvent("pinecone-fetch-error",{detail:{error:j,url:z}}))},S=(j,z,J,K,Z)=>{let X=(z.id??"")+J;if(L.has(X))return;L.add(X);let q=z.content;if(!q)return;let $=[];q.querySelectorAll("script").forEach((B)=>{let F=document.createElement("script");Array.from(B.attributes).forEach((G)=>F.setAttribute(G.name,G.value)),F.textContent=B.textContent,B.parentNode?.replaceChild(F,B)}),Array.from(q.children).forEach((B)=>{let F=B.cloneNode(!0);$.push(F),j.addScopeToNode(F,{},z),z.id&&F.setAttribute("template-id",z.id)}),j.mutateDom(()=>{if(K!=null)K.replaceChildren(...$);else z.after(...$);$.forEach((B)=>{j.initTree(B)})}),z._x_PineconeRouter_Template=$,z._x_PineconeRouter_TemplateUrls=Z,z._x_PineconeRouter_undoTemplate=()=>{z._x_PineconeRouter_Template?.forEach((B)=>B.remove()),delete z._x_PineconeRouter_Template},j.nextTick(()=>L.delete(X))},w=(j)=>{if(j._x_PineconeRouter_undoTemplate)j._x_PineconeRouter_undoTemplate(),delete j._x_PineconeRouter_undoTemplate},U=(j,z,J,K,Z,X)=>{if(J._x_PineconeRouter_TemplateUrls!=null&&J._x_PineconeRouter_TemplateUrls!=Z)w(J),J.innerHTML="";if(J._x_PineconeRouter_Template)return;if(J.content.childElementCount){if(S(j,J,K,X,Z),z.startEventDispatched)z.endLoading()}else if(Z)if(Z.every((q)=>O[q]))J.innerHTML="",Z.forEach((q)=>{J.innerHTML+=O[q]}),S(j,J,K,X,Z),z.endLoading();else V(Z,J).then(()=>S(j,J,K,X,Z)).finally(()=>z.endLoading())},m=(j,z)=>{return j.map((J)=>{return J.replace(/:([^/.]+)/g,(K,Z)=>{return z[Z]||Z})})},h=async(j)=>{if(Q.hasOwnProperty(j))return Q[j];else if(O[j])return O[j];else return Q[j]=fetch(j).then((z)=>{if(!z.ok){l(z.statusText,j);return}return z.text()}).then((z)=>{if(!z)return"";return O[j]=z,delete Q[j],z}),Q[j]},d=(j)=>{j.forEach((z)=>h(z))},V=(j,z)=>{return Promise.all(j.map((J)=>h(J))).then((J)=>{return z.innerHTML=J.join(""),z.innerHTML})};var b=(j,z)=>z.findIndex((J)=>J.path==j),D=(j,z,J)=>{if(j.indexOf(z)===-1)return J;let K=j[j.indexOf(z)+1];if(!K)return J;if(z==="target"){let Z=K.match(/([a-z0-9_-]+)/);if(Z)return Z[1]}return K},H=(j,z)=>{if(z!="/"&&!j.startsWith(z))j=z+j;if(j==z&&!j.endsWith("/"))j+="/";return j},N=(j,z)=>{let J=j??z??"",K=document.getElementById(J)??void 0;if(J.length&&K==null)throw new W(T(J));return K};var u=(j)=>{return{version:j,name:"pinecone-router",notfound:M("notfound",{}),routes:[],globalHandlers:[],context:{route:void 0,path:"",params:{},query:window.location.search.substring(1),hash:window.location.hash.substring(1),navigationStack:[],navigationIndex:0},settings:{hash:!1,basePath:"/",templateTargetId:void 0,interceptLinks:!0,alwaysSendLoadingEvents:!1},loadStart:new Event("pinecone-start"),loadEnd:new Event("pinecone-end"),endEventDispatched:!1,startEventDispatched:!1,startLoading:function(){if(!this.startEventDispatched)document.dispatchEvent(this.loadStart);this.startEventDispatched=!0},endLoading:function(){if(this.startEventDispatched&&!this.endEventDispatched)document.dispatchEvent(this.loadEnd);this.endEventDispatched=!0},add:function(J,K){if(this.routes.find((Z)=>Z.path==J)!=null)throw new W(P(J));if(K.templates&&K.preload)d(K.templates);return this.routes.push(M(J,K))-1},remove:function(J){let K=this.routes.findIndex((Z)=>Z.path==J);delete this.routes[K]},redirect:function(J){return this.navigate(J),0},canGoBack:function(){return this.context.navigationIndex>0},back:function(){this.navigate(this.context.navigationStack[this.context.navigationIndex-1],!1,!1,this.context.navigationIndex-1)},canGoForward:function(){return this.context.navigationIndex<this.context.navigationStack.length-1},forward:function(){this.navigate(this.context.navigationStack[this.context.navigationIndex+1],!1,!1,this.context.navigationIndex+1)},navigate:async function(J,K=!1,Z=!1,X){if(this.startEventDispatched=!1,this.endEventDispatched=!1,!J)J="/";if(J=H(J,this.settings.basePath),X!=null)this.context.navigationIndex=X;else if(J!=this.context.path)if(this.context.navigationIndex!==this.context.navigationStack.length-1)this.context.navigationStack=this.context.navigationStack.slice(0,this.context.navigationIndex+1),this.context.navigationStack.push(J),this.context.navigationIndex=this.context.navigationStack.length-1;else this.context.navigationStack.push(J),this.context.navigationIndex++;let q=this.routes.find(($)=>$.match(J))??this.notfound;if(q.handlersDone=!q.handlers.length&&!this.globalHandlers.length,this.settings.alwaysSendLoadingEvents||(q.handlers.length||this.globalHandlers.length||q.templates.length)&&this.context.path!=J)this.startLoading();if(this.context=R(q,J,this.context.navigationStack,this.context.navigationIndex),!K){let $="";if(this.settings.hash)$="#",$+=J;else $=J,$+=window.location.hash;if(!Z)history.pushState({path:$},"",$);else if(this.settings.hash){if(J=="/")return this.navigate("/",!1,!1)}}if(q&&(q.handlers.length||this.globalHandlers.length)){if(q.cancelHandlers=!1,await _(this.globalHandlers.concat(q.handlers),this.context,q)==0){this.endLoading();return}if(q.handlersDone=!0,!q.templates)this.endLoading()}if(q.programmaticTemplates){let $=document.getElementById(q.templateTargetId??this.settings.templateTargetId);if(!$)throw new W(x);V(q.templates,$).then(()=>{this.endLoading()})}if(this.settings.alwaysSendLoadingEvents)this.endLoading()}}};var i=(j,z)=>{j.directive("template",(J,{expression:K,modifiers:Z},{evaluate:X,cleanup:q,Alpine:$,effect:B})=>{if(!(J instanceof HTMLTemplateElement))throw new W(y);let F=J;if(F.content.firstElementChild!=null)throw new W(A);if(K=K.trim(),!(K.startsWith("[")&&K.endsWith("]"))&&!(K.startsWith("Array")&&K.endsWith(")")))K=`['${K}']`;let G=X(K),Y;if(typeof G=="object"&&Array.isArray(G))Y=G;else throw new W(I(typeof G));let k=N(D(Z,"target"),z.settings.templateTargetId);if(Z.includes("preload"))V(Y,F);if(F._x_PineconeRouter_route==null)throw new W(g);let v=F._x_PineconeRouter_route,C=v=="notfound"?z.notfound:z.routes[b(v,z.routes)];C.templates=Y,$.nextTick(()=>{B(()=>{if(C.handlersDone&&z.context.route==C){if(Z.includes("interpolate"))Y=m(C.templates,C.params);U($,z,F,K,Y,k)}else w(F)})}),q(()=>{F._x_PineconeRouter_undoTemplate&&F._x_PineconeRouter_undoTemplate()})})};var s=(j,z)=>{j.directive("handler",(J,{expression:K,modifiers:Z},{evaluate:X,cleanup:q})=>{let $;if(K=K.trim(),!(K.startsWith("[")&&K.endsWith("]"))&&!(K.startsWith("Array")&&K.endsWith(")")))K=`[${K}]`;let B=X(K);if(typeof B=="object")$=B;else throw new W(c(typeof B));for(let G=0;G<$.length;G++)$[G]=$[G].bind(j.$data(J));let F;if(Z.includes("global"))z.globalHandlers=$;else{if(!J._x_PineconeRouter_route)throw new W(f);let G=J._x_PineconeRouter_route;F=G=="notfound"?z.notfound:z.routes[b(G,z.routes)],F.handlers=$}q(()=>{if(Z.includes("global"))z.globalHandlers=[];else F.handlers=[],F.handlersDone=!0,F.cancelHandlers=!1})}).before("template")};var n=(j,z)=>{j.directive("route",(J,{expression:K,modifiers:Z},{cleanup:X,effect:q})=>{let $=K;if(!(J instanceof HTMLTemplateElement))throw new W(y);let B=J;if($.indexOf("#")>-1)throw new W(E);let F=N(D(Z,"target"),z.settings.templateTargetId),G;if($!="notfound")$=H($,z.settings.basePath),G=z.add($,{});let Y=G!=null?z.routes[G]:z.notfound;if(B._x_PineconeRouter_route=$,B.content.childElementCount)j.nextTick(()=>{q(()=>{Y.handlersDone&&z.context.route?.path==$?U(j,z,B,K,void 0,F):w(B)})});X(()=>{if(B._x_PineconeRouter_undoTemplate&&B._x_PineconeRouter_undoTemplate(),G!=null)delete z.routes[G];delete B._x_PineconeRouter_route})}).before("handler")};var p=(j)=>{function z(J){if(!J||!J.getAttribute)return;let K=J.getAttribute("href"),Z=J.getAttribute("target");if(!K||!K.match(/^\//g)||Z&&!Z.match(/^_?self$/i))return;return K}window.document.body.addEventListener("click",function(J){if(J.ctrlKey||J.metaKey||J.altKey||J.shiftKey||J.button||J.defaultPrevented)return;if(j.context.route&&!j.context.route?.handlersDone)j.context.route.cancelHandlers=!0,j.endLoading();let K=J.target;do if(K instanceof HTMLAnchorElement&&K.getAttribute("href")){if(j.settings.interceptLinks==!1&&!K.hasAttribute("x-link"))return;if(K.hasAttribute("data-native")||K.hasAttribute("native"))return;let Z=z(K);if(Z){if(j.navigate(Z),J.stopImmediatePropagation)J.stopImmediatePropagation();if(J.stopPropagation)J.stopPropagation();J.preventDefault()}break}while(K=K.parentNode)})};var r=function(j){let z=j.reactive(u("7.0.0"));window.PineconeRouter=z,document.addEventListener("alpine:initialized",()=>{if(z.settings.hash==!1)z.navigate(location.pathname+location.search,!1,!0);else z.navigate(location.hash.substring(1),!1,!0)}),window.addEventListener("popstate",()=>{if(z.settings.hash){if(window.location.hash!="")z.navigate(window.location.hash.substring(1),!0)}else z.navigate(window.location.pathname,!0)}),i(j,z),s(j,z),n(j,z),j.$router=z,j.$params=z.context.params||{},j.magic("router",()=>z),j.magic("params",(J,{Alpine:K})=>K.$params),p(z)},o=r;var f1=o;export{f1 as default};

//# debugId=09FE712A79D182B664756E2164756E21
//# sourceMappingURL=router.esm.js.map
